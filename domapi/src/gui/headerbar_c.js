// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.loadUnit("drag");core.registerComponent("headerbar");function Headerbar(arg){arg.h=core.rInt(arg.h,18);var e=core._component(arg,"headerbar");var path=core.rVal(arg.path,core.imagePath+"buttons/");e.sortUpGif=path+"sortup.gif";e.sortDownGif=path+"sortdown.gif";e.resizeBdr=7;e.doColSort=true;e.doColResize=true;e.doColMove=true;var tbl=document.createElement("TABLE");var tb=document.createElement("TBODY");e.row=document.createElement("TR");e.cols=e.row.cells;tb.appendChild(e.row);tbl.appendChild(tb);e.appendChild(tbl);tbl.setAttribute("border",0);tbl.setAttribute("cellPadding",0);tbl.setAttribute("cellSpacing",0);tbl.style.tableLayout="fixed";e.ghost=core.createElm(e,0,0,50,arg.h);e.ghost.setAlpha(70);e.ghost.setZ(1000);e.ghost.setBgColor(e.theme.captionBgColor1);e.ghost.setColor(e.theme.captionFgColor);e.ghost.hide();e.onmouseover=e._mouseover;e.onmouseout=e._mouseout;e.onclick=e._click;e.onmousemove=e._mousemove;e.onsort=function(i,dir){};e.onresizing=function(i,w){};e.onresized=function(i,w){};e.oncolswap=function(i,j){};e.allowResize(e.doColResize);e.allowMove(e.doColMove);e.reDraw();return e};core.comps.headerbar.reDraw=function(){this.headerbarReDraw();this.onredraw()};core.comps.headerbar.headerbarReDraw=function(){var t=this.theme;var s=this.style;s.font=t.ctrlFont;this.setColor(t.ctrlFgColor);this.setBgColor(t.ctrlBgColor);this.setB(t.bdrWidth);s.borderStyle=this.doBorder?t.bdrSolid:"none";s.borderColor=t.bdrDark;s.overflow="hidden";for(var i=0;i<this.cols.length;i++)this.reDrawItem(this.cols[i])};core.comps.headerbar.reDrawItem=function(n){var t=this.theme;var s=n.style;s.font=t.ctrlFont;s.borderStyle=t.bdrSolid;s.borderColor=t.getOutset();s.borderWidth=t.bdrWidth;s.padding="0px 4px 1px";s.backgroundColor=t.ctrlBgColor;s.color=t.ctrlFgColor};core.comps.headerbar._adjustTableWidth=function(){var table=this.row.parentNode.parentNode;var b=core.rInt(this.theme.bdrWidth,1)*7;var c=this.cols;var w=0;for(var a=0;a<c.length;a++)w+=parseInt(c[a].getAttribute("width"))+b;table.setAttribute("width",w)};core.comps.headerbar._setEnabled=function(b){this.enabled=b;this._turnOnDrag();this.reDraw()};core.comps.headerbar.setEnabled=function(b){this._setEnabled(b)};core.comps.headerbar._turnOnDrag=function(){for(var a=0;a<this.cols.length;a++)if((this.doColResize||this.doColMove)&&this.enabled){this.cols[a].turnOnDrag(this.ghost,core.drag.dtCustom,0,this.moveDragStart,this.moveDragMove,this.moveDragEnd)}else{this.cols[a].turnOffDrag()}};core.comps.headerbar.addCol=function(arg){var w=core.rInt(arg.w,60);var b=core.rInt(this.theme.bdrWidth);if(core.isNS)w=w-(8*b);var e=document.createElement("TD");e.innerHTML='<span>'+core.rVal(arg.caption)+'</span> <img src="'+this.sortUpGif+'" /><img src="'+this.sortDownGif+'" />';e.setAttribute("width",w);e.setAttribute("height",this.getH());if(arg.hint)e.title=arg.hint;this.row.appendChild(e);e.style.textAlign=core.rVal(arg.align,"left");var c=e.getElementsByTagName("IMG");e.upBtn=c[0];e.dwnBtn=c[1];c=e.getElementsByTagName("SPAN");e.caption=c[0];this.reDrawItem(e);e.upBtn.style.display="none";e.dwnBtn.style.display="none";e.caption.style.cursor="default";e.caption.domAPIObjType="CAPTION";e.domAPIObjType="COL";var p=core.elmProto;e.turnOnDrag=p.turnOnDrag;e.turnOffDrag=p.turnOffDrag;e.cancelDrag=p.cancelDrag;e.getX=p.getX;e.getY=p.getY;e.getW=function(){return parseInt(this.getAttribute("width"))};e.bringToFront=p.bringToFront;e.setZ=p.setZ;if(this.doColResize||this.doColMove)e.turnOnDrag(this.ghost,core.drag.dtCustom,0,this.moveDragStart,this.moveDragMove,this.moveDragEnd);if(core.isNS)this._adjustTableWidth();return e};core.comps.headerbar.swapCols=function(i,j){if(i==j)return;if(!this.cols[i]||!this.cols[j])return;if(i>j){var t=i;i=j;j=t}this.cols[i].swapNode(this.cols[j]);this.oncolswap(i,j)};core.comps.headerbar.deleteCol=function(i){this._deleteCol(i)};core.comps.headerbar.deleteCols=function(){this._deleteCols()};core.comps.headerbar._deleteCol=function(i){if(i<0||i>(this.cols.length-1))return;this.cols[i].removeNode(true)};core.comps.headerbar._deleteCols=function(){for(var a=this.cols.length;a>0;a--)this._deleteCol(a-1)};core.comps.headerbar._mouseover=function(E){var td=core.findTarget(E,"COL");if(!td)return;if(this.inResize||!this.enabled)return;if(this.doRollover&&!this._inResizeRange(td,E)){td.style.backgroundColor=this.theme.shadowBg;td.style.color=this.theme.shadowFg}else this._mouseout(E)};core.comps.headerbar._mouseout=function(E){var td=core.findTarget(E,"COL");if(!td)return;if(this.inResize)return;td.style.backgroundColor=this.theme.ctrlBgColor;td.style.color=this.theme.ctrlFgColor};core.comps.headerbar._mousemove=function(E){var td=core.findTarget(E,"COL");if(!td)return;if(this.inResize||!this.enabled)return;var s=td.style;if(this.doColResize){if(this._inResizeRange(td,E)){if(s.cursor!=core.cursors.vertBeam){this._mouseout(E);s.cursor=core.cursors.vertBeam}}else{if(s.cursor!="default"){this._mouseover(E);s.cursor="default"}}}else s.cursor="default"};core.comps.headerbar._click=function(E){if(this.inResize||this.inMove||!this.enabled)return;var td=core.findTarget(E,"COL");if(!td)return;if(this.doColSort&&!this._inResizeRange(td,E)){var i=core.getNodeIndex(td);status=i;var dir=td.dwnBtn.style.display=="none"?0:1;this.sortCol(i,dir);this.onsort(i,dir)}};core.comps.headerbar.sortCol=function(i,dir){var td=this.cols[i];if(!td)return;for(var a=0;a<this.cols.length;a++)if(this.cols[a]!=td)with(this.cols[a]){dwnBtn.style.display="none";upBtn.style.display="none"}td.dwnBtn.style.display=dir?"none":"";td.upBtn.style.display=dir?"":"none"};core.comps.headerbar.hideCol=function(i){this.cols[i].style.display="none"};core.comps.headerbar.showCol=function(i){this.cols[i].style.display="inline"};core.comps.headerbar.clearArrows=function(){var c=this.cols;for(var a=0;a<c.length;a++){c[a].dwnBtn.style.display="none";c[a].upBtn.style.display="none"}};core.comps.headerbar.allowResize=function(b){this.doColResize=b;this._turnOnDrag()};core.comps.headerbar._inResizeRange=function(td,E){if(this.doColResize){var b=this.resizeBdr;if(core.isNS){var w=0;var t=td.previousSibling;while(t){w+=t.offsetWidth;t=t.previousSibling}var xOff=E.layerX-w}else var xOff=event.offsetX;return xOff>=(td.offsetWidth-b)}else return false};core.comps.headerbar.allowMove=function(b){this.doColMove=b;this._turnOnDrag()};core.comps.headerbar.moveDragStart=function(){var e=this.elm;var t=this.trueElm;if(!e)return;if(!t.style)return;if(t.inMove||t.inResize)return;if(!t.getW)return;var p=core.findParent(e,"HEADERBAR");t.colIndex=core.getNodeIndex(t);if(t.style.cursor!="default"){if(!p.doColResize)return;p.inResize=true;t.inResize=true;t.sW=t.getW()}else{if(t.tagName!="TD")return;if(!p.doColMove||!e.setW||!t.getW)return;e.setW(t.getW());e.setText(t.innerHTML);e.moveTo(t.offsetLeft);p.inMove=true;t.inMove=true;t.sX=e.getX()}};core.comps.headerbar.moveDragMove=function(eX,eY,dX,dY){var e=this.elm;var t=this.trueElm;if(!e)return;if(!e.parentNode.enabled)return;if(t.inResize){if(!e.parentNode.doColResize)return;var w=t.sW+dX;if(w<10)return;t.setAttribute("width",w);if(core.isNS)e.parentNode._adjustTableWidth();e.parentNode.onresizing(t.colIndex,w)}else{if(t.tagName!="TD")return;if(!e.parentNode.doColMove)return;if(Math.abs(dX)<8)return;e.show();e.setX(t.sX+dX)}};core.comps.headerbar.moveDragEnd=function(){var e=this.elm;var t=this.trueElm;var p=core.findParent(e,"HEADERBAR");if(!e)return;if(t.inResize){t.inResize=false;p.inResize=false;p.onresized(t.colIndex,t.getW())}else{if(t.tagName!="TD")return;e.hide();t.style.backgroundColor=p.theme.ctrlBgColor;t.style.color=p.theme.ctrlFgColor;p.inMove=false;t.inMove=false;var x=e.getX();var curI=t.colIndex;var newI=curI;if(x<0)newI=0;if(x>p.cols[p.cols.length-1].getX())newI=p.cols.length-1;for(var a=0;a<p.cols.length-1;a++)if((x>p.cols[a].getX())&&(x<p.cols[a].getX()+p.cols[a].getW())){newI=a+1;break}if(newI!=curI)p.swapCols(curI,newI)}};
