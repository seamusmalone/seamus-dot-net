// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.loadUnit("dropdown");core.loadUnit("listbox");core.registerComponent("combobox");function Combobox(arg){var h=arg.h;arg.w=core.rInt(arg.w,150);arg.h=22;var e=core._component(arg,"combobox",true);e._constructor=core.comps.combobox._constructor;e._constructor(arg.pathToButtons,arg.value,h);e.reDraw();return e};core.comps.combobox._constructor=function(pathToButtons,value,h){core._inherit(this,"dropdown");this._constructor(pathToButtons);core._inherit(this,"combobox");this.value=core.rVal(value,"");this.edit.value=this.value;this.valueStr=core.createElm(this,0,0,100,100);this.allowEdit=true;this.valueStr.hide();this.pathToButtons=core.rVal(pathToButtons,core.imagePath+"buttons/");this.dropDown=Listbox({theme:this.theme,w:0,y:this.getH(),w:this.getW(),h:core.rInt(h,130)-this.getH()});var t=core.comps.combobox;this.dropDown.onbeforechange=t._onbeforechange;this.dropDown.onchange=t.onchange;this.edit.onchange=t._eonchange;this.dropDown.parent=this;this.dropDown.hide();this.dropDown.allowNoSelect=true;this.comboReDraw=this.reDraw};core.comps.combobox.reDraw=function(){this.dropdownReDraw();this.comboboxReDraw();this.onredraw()};core.comps.combobox.comboboxReDraw=function(){var t=this.dropDown;t.theme=this.theme;t.reDraw();t.setBgColor(t.theme.bgColor);t.style.borderColor=t.theme.bdrColor;t.style.borderStyle=t.theme.bdrSolid;t.setB(1);t=this.valueStr;t.setB(core.rInt(this.theme.bdrWidth,1));t.setP([2,0,0,2]);var b=core.isIE?[0,0,0,0]:t.getB();var p=core.isIE?[0,0,0,0]:t.getP();t.style.font=this.theme.font;t.style.borderStyle=this.theme.bdrSolid;t.style.borderColor=this.theme.getInset();t.setSize(this.getW()-this.dropBtn.getW()-b[1]-b[3]+p[3],this.getH()-b[0]-b[2]+p[0]);t.setColor(this.theme.fgColor);t.setBgColor(this.theme.bgColor)};core.comps.combobox.setEnabled=function(b){this.enabled=b;this.dropBtn.enabled=b;this.dropDown.enabled=b;this.edit.disabled=!b};core.comps.combobox.setDoRollover=function(b){this.doRollover=b;this.dropBtn.doRollover=b;this.dropDown.doRollover=b};core.comps.combobox.setAllowEdit=function(b){if(!b){this.edit.hide();this.valueStr.show();if(core.isNil(this.value)&&(this.dropDown.items.length>0)){this.dropDown.selectItem(0);this.dropBtn.onclick()}}else{this.edit.show();this.valueStr.hide()}this.allowEdit=b};core.comps.combobox._onbeforechange=function(v){return this.parent.onbeforechange(v.innerHTML)};core.comps.combobox.onchange=function(i){var v=i?i.innerHTML:"";var r=this.parent;if(!r)return;if(typeof r.onbeforechange!="function")return;if(!r.onbeforechange(v))return;r.value=v;r.edit.value=r.value;r.valueStr.setText(r.value);if(r.autoClose&&i)r.dropBtn.onclick();this.setFormValue(r.hiddenE);r._onchange(i)};core.comps.combobox._eonchange=function(){var p=this.parentNode;if(!p.onbeforechange(this.value)){this.value=p.value;return}p.value=this.value;p._onchange(p.value)};
