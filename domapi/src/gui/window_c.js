// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.loadUnit("drag");core.loadUnit("label");core.loadUnit("button");core.loadUnit("imagelist");core.registerComponent("window");core.comps.window.doManageFocus=true;core.comps.window.destroyOnClose=true;core.comps.window.mapW=80;core.comps.window.mapH=14;core.comps.window.resizeBdr=20;core.comps.window.minH=40;core.comps.window.minW=120;core.comps.window.minimizedW=150;core.comps.window.visibleButtons=1+2+8;function Window(arg){var img=core.rVal(arg["img"],core.imagePath+"windows/buttons2.gif");arg.w=core.rInt(arg["w" ],core.comps.window.minW);arg.h=core.rInt(arg["h" ],core.comps.window.minW);var e=core._component(arg,"window");e.imageCount=5;e.C_MIN=0;e.C_MAX=1;e.C_HLP=2;e.C_CLS=3;e.C_RES=4;e.btnConst=[e.C_MIN,e.C_MAX,e.C_HLP,e.C_CLS,e.C_RES];e.btnTitle=["MINIMIZE","MAXIMIZE","HELP","CLOSE"];e.imgW=core.rInt(arg["imgW"],e.mapW)/e.imageCount;e.imgH=core.rInt(arg["imgH"],e.mapH);e.path=img;e.titleBar=core.createElm(e);e.caption=Label({parent:e.titleBar});e.createControls=arg["createControls"];if(typeof e.createControls=="undefined")e.createControls=true;e.controls=core.createElm(e.titleBar,0,0,e.imgW,e.imgH);if(e.createControls){e.buttons=[];var b;for(var a=0;a<e.btnTitle.length;a++){e.buttons[a]=Button({parent:e.controls,theme:e.theme,x:0,y:0,w:e.imgW,h:e.imgH});b=e.buttons[a];b.cell.innerHTML="";b.image=ImageList(b.cell,img,e.imageCount,e.imgW,e.imgH);b.doBorder=false;b.doRollover=false;b.image.setImage(e.btnConst[a]);b.image.I.title=core.getString("WINDOW_"+e.btnTitle[a]);if(core.isNS){b.setVerticalAlign("top");b.style.padding="0px";b.theme.bdrWidth=0;b.setSize(e.imgW,e.imgH);b.image.style.top="-3px"}switch(a){case e.C_MIN:b.onclick=function(E){core.findTarget(E,"WINDOW").minimize()};b.idx=1;break;case e.C_MAX:b.onclick=function(E){core.findTarget(E,"WINDOW").maximize()};b.idx=2;break;case e.C_HLP:b.onclick=function(E){core.findTarget(E,"WINDOW").help()};b.idx=4;break;case e.C_CLS:b.onclick=function(E){core.findTarget(E,"WINDOW").close()};b.idx=8;break}}e.controls.setZ(1)}e.titleBar.style.display="block";e.titleBar.ondblclick=function(E){var e=core.findTarget(E,"WINDOW");if(!e)return;if(e.isMinimized)return;if(e.isMaximized)e.restore();else e.maximize()};e.workspace=core.createElm(e,null,null,null,null,null,null,arg["kind"]);e.workspace.style.display="block";e.workspace.setAttribute("height","100%");e.onmouseover=e.mouseOverFrame;e.onmouseout=e.mouseOutFrame;e.isOpen=true;e.isMinimized=false;e.isMaximized=false;e.doAllowMove=true;e.doAllowResize=true;e.setCaption(arg["caption"]);e.titleBarHeight=20;e.controlsAlign="right";e.titlePadding=2;e.onresize=function(){};e.onmove=function(){};e.restorePoint={x:0,y:0,w:0,h:0,doAllowMove:true,doAllowResize:true};e.reDraw();e.resized();e.allowMove(e.doAllowMove);e.allowResize(e.doAllowResize);core.addEvent(e,"mousedown",e.windowClicked);core.addEvent(e.caption,"mousedown",e.windowClicked);e.setActive();return e};core.comps.window.reDraw=function(){this.windowReDraw();this.onredraw()};core.comps.window.windowReDraw=function(){var t=this.theme;var s=this.style;s.borderStyle=t.bdrSolid;this.setB(parseInt(t.bdrWidth));s.borderColor=t.getOutset();s.backgroundColor=t.ctrlBgColor;s.padding=core.rInt(t.bdrWidth)*2+"px";s=this.titleBar.style;s.backgroundColor=t.captionBgColor1;s.paddingLeft=this.titlePadding+"px";s=this.caption.cell.style;s.font=t.captionFont;s.backgroundColor=t.captionBgColor1;s.color=t.captionFgColor;s.fontWeight="bold";s.height=this.titleBarHeight+"px";s.padding="0px "+this.titlePadding+"px";s=this.caption;s.setVerticalAlign("middle");s=this.workspace.style;s.font=t.font;s.backgroundColor=t.bgColor;s.color=t.fgColor;s.margin=core.rInt(t.bdrWidth)+"px";s.scrolling="auto";s.overflow="auto";s.borderStyle=t.bdrSolid;this.workspace.setB(t.bdrWidth);s.borderColor=t.getInset();if(this.createControls){for(var a=0;a<this.buttons.length;a++){this.buttons[a].reDraw();this.buttons[a].setBgColor(t.captionBgColor1)}}this.resized()};core.comps.window.windowClicked=function(E){var e=core.findTarget(E,"WINDOW");if(!e)return;if(e.doManageFocus)e.setActive()};core.comps.window.setActive=function(){var t=this.theme;var b=core.bags.window;for(var a=0;a<b.length;a++)if(b[a]==this){this.active=false;this.titleBar.style.backgroundColor=t.captionBgColor1;this.titleBar.style.color=t.captionFgColor;this.caption.cell.style.backgroundColor=t.captionBgColor1;this.caption.cell.style.color=t.captionFgColor;if(this.createControls)for(var c=0;c<this.buttons.length;c++)this.buttons[c].cell.style.backgroundColor=t.captionBgColor1;this.onactivate();this.bringToFront()}else{b[a].active=false;b[a].titleBar.style.backgroundColor=t.inactiveBgColor;b[a].titleBar.style.color=t.inactiveFgColor;b[a].caption.cell.style.backgroundColor=t.inactiveBgColor;b[a].caption.cell.style.color=t.inactiveFgColor;if(b[a].createControls)for(var c=0;c<b[a].buttons.length;c++)b[a].buttons[c].cell.style.backgroundColor=t.inactiveBgColor;b[a].ondeactivate()}};core.comps.window.layoutButtons=function(){if(!this.createControls)return;var clsShowing=this.visibleButtons&8;var showing=[];for(var a=0;a<this.buttons.length;a++)if(this.visibleButtons&this.buttons[a].idx){showing.push(this.buttons[a]);this.buttons[a].show()}else this.buttons[a].hide();this.controls.setW(this.imgW*showing.length+(clsShowing?2:0));if(this.controlsAlign=="left"&&clsShowing){var t=showing.pop();showing.insert(0,t)}var x;for(a=0;a<showing.length;a++){x=0;if(showing[a].idx==8&&this.controlsAlign=="right")x=2;if(clsShowing&&a>0&&this.controlsAlign=="left")x=2;showing[a].setX(this.imgW*a+x)}};core.comps.window.allowMove=function(b){if(b)this.titleBar.turnOnDrag(this,null,null,null,null,function(){this.elm.onmove()});else this.titleBar.turnOffDrag();this.doAllowMove=b};core.comps.window.allowResize=function(b){if(b)this.turnOnDrag(null,core.drag.dtCustom,5,this.dragStart,this.dragMove,this.dragEnd);else this.turnOffDrag(this);this.doAllowResize=b};core.comps.window.resized=function(){if(!this.buttons)this.controls.setW(0);var t=this.titleBar;var ch=(t.style.display=="none")?0:t.getH();var b=core.rInt(this.theme.bdrWidth);b=b*2*4;if(!this.isMinimized){this.workspace.setW(this.getW()-b);this.workspace.setH(this.getH()-b-ch)}if(t.style.display!="none"){var p=this.titlePadding;var tw=this.getW();var y=parseInt(this.titleBarHeight/2-this.imgH/2);var cnw=this.controls.getW();var caw=tw-cnw-p*5;this.caption.setW(caw);this.titleBar.setW(tw-p*4);if(this.controlsAlign=="left"){this.controls.moveTo(p,y);this.caption.style.left=(cnw+p)+"px"}else if(this.controlsAlign=="right"){this.caption.style.left="0px";this.controls.moveTo(caw,y)}}this.layoutButtons()};core.comps.window.mouseOverFrame=function(E){var b=this.resizeBdr;if(this.isMinimized||this.isMaximized||this.indrag||!this.doAllowResize)return;if(core.getTarget(E)!=this)return;if(core.isIE){var xOff=window.event.offsetX;var yOff=window.event.offsetY}if(core.isNS){var xOff=E.layerX;var yOff=E.layerY}this.resizeDir="";if(yOff<=b)this.resizeDir+="n";else if(yOff>=this.offsetHeight-b)this.resizeDir+="s";if(xOff<=b)this.resizeDir+="w";else if(xOff>=this.offsetWidth-b)this.resizeDir+="e";if(this.resizeDir==""){this.onmouseout(E);return}if(core.isIE)document.body.style.cursor=this.resizeDir+"-resize";if(core.isNS)this.style.cursor=this.resizeDir+"-resize"};core.comps.window.mouseOutFrame=function(E){if(this.indrag)return;if(core.isIE)document.body.style.cursor="";if(core.isNS)this.style.cursor=""};core.comps.window.setCaption=function(caption){this.caption.setCaption(caption)};core.comps.window.setCaptionAlign=function(a){this.caption.setTextAlign(a)};core.comps.window.showTitleBar=function(b){this.titleBar.style.display=b?"block":"none";this.resized()};core.comps.window.setText=function(s){var e=this.workspace;if(e.tagName!="IFRAME")e.innerHTML=s};core.comps.window.transferElm=function(e){var t=this.workspace;if(t.tagName!="IFRAME"){var temp=e.parentNode.removeChild(e);t.insertAdjacentElement("beforeEnd",temp)}};core.comps.window.loadURL=function(url){var e=this.workspace;if(e.tagName=="IFRAME"){e.src=core.rVal(url,"about:blank");this.resized()}else alert(core.getString("WINDOW_NOT_IFRAME"))};core.comps.window.close=function(){this.style.display="none";this.isOpen=false;if(this.destroyOnClose)this.remove()};core.comps.window.open=function(){this.style.display="";this.isOpen=true};core.comps.window.minimize=function(){if(!this.isOpen||this.isMinimized)return;var s=this.style;var b=core.rInt(this.theme.bdrWidth,2);if(!this.isMaximized){this.restorePoint.w=this.getW();this.restorePoint.h=this.getH();this.restorePoint.x=this.getX();this.restorePoint.y=this.getY()}this.setW(this.minimizedW);s.height=this.titleBarHeight+(this.titlePadding*2+b*2)+"px";this.workspace.style.display="none";this.isMinimized=true;this.isMaximized=false;if(this.buttons&&(this.visibleButtons&2))with(this.buttons[this.C_MAX]){image.setImage(this.btnConst[this.C_RES]);image.I.title=core.getString("WINDOW_RESTORE");onclick=function(E){core.findTarget(E,"WINDOW").restore()}}this.reDraw()};core.comps.window.maximize=function(){if(!this.isOpen||this.isMaximized)return;var p=this.titlePadding*2;if(!this.isMinimized){var r=this.restorePoint;r.w=this.getW();r.h=this.getH();r.x=this.getX();r.y=this.getY();r.doAllowMove=this.doAllowMove;r.doAllowResize=this.doAllowResize}this.allowMove(false);this.allowResize(false);this.workspace.style.display="block";this.moveTo(0,0);var s=this.parentNode.style;if(s.overflow!="hidden"&&s.overflow!="clip")s.overflow="auto";this.setSize(this.parentNode.offsetWidth-p,this.parentNode.offsetHeight-p);this.isMinimized=false;this.isMaximized=true;if(this.buttons&&(this.visibleButtons&2))with(this.buttons[this.C_MAX]){image.setImage(this.btnConst[this.C_RES]);image.I.title=core.getString("WINDOW_RESTORE");onclick=function(E){core.findTarget(E,"WINDOW").restore()}}this.reDraw()};core.comps.window.restore=function(){if(!this.isOpen||!(this.isMinimized||this.isMaximized))return;var r=this.restorePoint;this.setSize(r.w,r.h);this.moveTo(r.x,r.y);this.allowResize(r.doAllowResize);this.allowMove(r.doAllowMove);this.workspace.style.display="block";this.resized();this.isMinimized=false;this.isMaximized=false;if(this.buttons&&(this.visibleButtons&2))with(this.buttons[this.C_MAX]){image.setImage(this.btnConst[this.C_MAX]);image.I.title=core.getString("WINDOW_MAXIMIZE");onclick=function(E){core.findTarget(E,"WINDOW").maximize()}}this.reDraw();this.resized()};core.comps.window.dragStart=function(){var e=this.elm;if(!e)return;if(e.indrag)return;var w=e.workspace;if(!w)return;e.indrag=true;e.sX=e.getX();e.sY=e.getY();e.sW=e.getW();e.sH=e.getH();e.wX=w.getX();e.wY=w.getY();e.wW=w.getW();e.wH=w.getH()};core.comps.window.dragMove=function(eX,eY,dX,dY){var E=this.elm;var W=E.workspace;var d=E.resizeDir;if(!d)return;var n=(d.charAt(0)=="n");var s=(d.charAt(0)=="s");var e=(d.charAt(0)=="e"||d.charAt(1)=="e");var w=(d.charAt(0)=="w"||d.charAt(1)=="w");if(w){dX=-dX;E.setX(E.sX-dX)}if(n){dY=-dY;E.setY(E.sY-dY)}if(s||n){var h=E.sH+dY;if(h>E.minH){E.setH(h);W.setH(E.wH+dY)}}if(e||w){var w=E.sW+dX;if(w>E.minW){E.setW(w);W.setW(E.wW+dX)}}E.resized();E.onresize()};core.comps.window.dragEnd=function(){this.elm.indrag=false};
