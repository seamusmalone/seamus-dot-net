// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.loadUnit("imagelist");core.registerComponent("tree");core._treeInit=function(){core._treeConst={};var t=core._treeConst;t.BLANK=0;t.I=1;t.T=2;t.L=3;t.MAX=4;t.MIN=5;t.MAX_L=6;t.MIN_L=7;t.MAX_T=8;t.MIN_T=9;t.MAX_F=10;t.MIN_F=11;t.SPECIAL1=12;t.SPECIAL2=13;t.SPECIAL3=14;t.SPECIAL4=15;t.SPECIAL5=16;t.SPECIAL6=17;t.SPECIAL7=18;t.SPECIAL8=19;t.TOGGLES=[t.MAX,t.MIN,t.MAX_L,t.MIN_L,t.MAX_T,t.MIN_T];t.FOLDERS=[t.MAX_F,t.MIN_F,t.SPECIAL1,t.SPECIAL2,t.SPECIAL3,t.SPECIAL4,t.SPECIAL5,t.SPECIAL6,t.SPECIAL7,t.SPECIAL8]};core._treeInit();core.comps.tree.defDelimter="/";core.comps.tree.doDebug=true;function Tree(arg){var e=core._component(arg,"tree");e.img=core.rVal(arg["img"],core.imagePath+"trees/win2k.gif");e.style.cursor="default";e.setOverflow("auto");e.setP(0);e.onselect=function(){};e.selected=null;e.nodes=[];e.showSelection=true;e.maxLevel=0;e.tree=e;e.level=0;e.quickMode=true;e.baseImg=ImageList(null,e.img,20,16,16);e.baseImg.style.top=core.isNS?"-2px":"3px";core.disallowSelect(e);e.reDraw();return e};Tree.constants=core._treeConst;core.comps.tree.reDraw=function(){this.treeReDraw();this.onredraw()};core.comps.tree.treeReDraw=function(){var t=this.theme;var s=this.style;this.setB(t.bdrWidth);this.setBgColor(t.bgColor);s.borderStyle=t.bdrSolid;s.font=t.font;s.borderColor=t.getInset();s.scrollbarBaseColor=t.ctrlBgColor;var len=this.nodes.length;for(var a=0;a<len;a++)this.nodes[a].reDraw(true)};core.comps.tree.ondblclick=function(e){core.preventBubble(e);var i=core.findTarget(e,"IMAGELIST");var c=core._treeConst;if(i){if(c.FOLDERS.indexOf(i.index)>-1)core.findParent(i,"TREENODE").toggle();return}i=core.findTarget(e,"TREENODE");if(i)i.toggle()};core.comps.tree.onclick=function(e){core.preventBubble(e);var i=core.findTarget(e,"IMAGELIST");var c=core._treeConst;var n=core.findTarget(e,"TREENODE");if(i){if(c.TOGGLES.indexOf(i.index)>-1)n.toggle();if(c.FOLDERS.indexOf(i.index)>-1)this.selectNode(n)}else if(n)this.selectNode(n)};core.comps.tree.onmouseover=function(e){core.preventBubble(e);if(!this.doRollover)return;var t=this.theme;var n=core.findTarget(e,"TREENODE");if(n&&(!n.selected||!this.showSelection))this.colorNode(n,t.hlBgColor,t.hlFgColor,t.hlFont)};core.comps.tree.onmouseout=function(e){core.preventBubble(e);var t=this.theme;var n=core.findTarget(e,"TREENODE");if(n&&(!n.selected||!this.showSelection))this.colorNode(n,t.bgColor,t.fgColor,t.font)};core.comps.tree.selectNode=function(n){if(this.selected){this.selected.selected=false;this.selected.reDraw(false)}this.expandToPath(n.getPath());this.selected=n;n.selected=true;this.setFormValue(this.hiddenE);n.reDraw(false);n.onselect();this.onselect();if(n.fn&&n.fn!="undefined"){if(typeof(n.fn)=="object"){var obj=n.fn.obj;var fn=n.fn.fn;var params=[].concat(n.fn.params);if(this.doDebug)if(obj)alert("OO with object, obj: "+obj+"\nfn:\n"+fn+"\nparams: "+params.toString());else alert("OO with null-object, obj: "+obj+"\nfn:\n"+fn+"\nparams: "+params.toString());fn.apply(obj,params)}else{if(this.doDebug)alert("Non-OO, fn:\n"+n.fn);eval(n.fn)}}};core.comps.tree.add=function(arg){var i=this.nodes.length;arg.parent=this;this.nodes[i]=Treenode(arg);return this.nodes[i]};core.comps.tree.addPath=function(arg){var p=arg.path;var d=arg.del;p=p.split(core.rVal(d,core.comps.tree.defDelimter));var a,b,found,s,last;var r=this;for(a=0;a<p.length;a++){found=0;s=0;for(b=0;b<r.nodes.length;b++){s=r.nodes[b];if(s.getText()==p[a]){r=s;found=1;break}}if(!found){last=a==(p.length-1);r=r.add({caption:p[a],fn:last?arg.fn:null,folder:arg.folder})}}return r};core.comps.tree.collapse=function(recurse){this.popNode(false,recurse)};core.comps.tree.expand=function(recurse){this.popNode(true,recurse)};core.comps.tree.popNode=function(disp,recurse){if(recurse==null)recurse=false;var c,a;var tree=this.tree;var iStart=this.level+1;var iEnd=recurse?this.tree.maxLevel:iStart;var p=this.domAPIObjType=="TREE"?"~":this.getPath().split("/").join("~");while(iEnd>=iStart){c=this.getNodesByLevel(iEnd);for(a=0;a<c.length;a++){if(!this.built&&this.tree.quickMode)this.tree.initNode(c[a]);c[a].style.display=disp?"block":"none"}iEnd--}this.expanded=disp;this.reDraw(false)};core.comps.tree.toggle=function(){if(this.expanded)this.collapse();else{this.expand();if(this.tree.quickMode&&!this.built){for(var a=0;a<this.nodes.length;a++)this.tree.initNode(this.nodes[a]);this.built=true}}return this.expanded};core.comps.tree.init=function(){for(var a=0;a<this.nodes.length;a++)this.initNode(this.nodes[a]);this.collapse(true)};core.comps.tree.initNode=function(n){var i,a,t;var c=core._treeConst;var tree=n.tree;var lev=n.level+2;var z=lev-2;var imgs=n.childNodes[0];while(imgs.childNodes.length<lev)imgs.appendChild(n.tree.baseImg.clone());while(imgs.childNodes.length>lev)imgs.removeChild(imgs.childNodes[0]);imgs.childNodes[lev-1].setImage((n.folder!=c.MIN_F)?n.folder:c.MIN_F);if(lev>1){if(n.nodes.length==0)i=n.nextSibling?c.T:c.L;else{if(n.nextSibling){i=n.expanded?c.MAX_T:c.MIN_T}else{i=n.expanded?c.MAX_L:c.MIN_L}}if(lev==2){n.style.display="block";i=n.expanded?c.MAX:c.MIN}imgs.childNodes[z].setImage(i)}if(lev>2)for(a=1;a<z;a++){t=tree.moveUp(n,a);imgs.childNodes[z-a].setImage((t&&t.nextSibling)?c.I:c.BLANK)}n.reDraw();if(!tree.quickMode)for(var a=0;a<n.nodes.length;a++)core.comps.tree.initNode(n.nodes[a])};core.comps.tree.getPath=function(d){d=core.rVal(d,core.comps.tree.defDelimter);var r=d+this.getText();var p=this.parentNode;if(!p)return r;while(true)if(p.domAPIObjType=="TREE")return r;else{r=d+p.getText()+r;p=p.parentNode}return null};core.comps.tree.getLevel=function(n){if(!n||!n.parentNode)return 0;var r=0;var p=n.parentNode;while(p){if(p.domAPIObjType=="TREE")return r;else{if(p.domAPIObjType=="TREENODE")r++;p=p.parentNode}}return r};core.comps.tree.moveUp=function(n,i){var r=null;var p=n.parentNode;while((i>0)&&p){if(p.domAPIObjType=="TREE")return r;else{if(p.domAPIObjType=="TREENODE"){r=p;i--}p=p.parentNode}}return r};core.comps.tree.colorNode=function(n,bg,fg,fnt){var s=n.childNodes[1].style;s.backgroundColor=bg;s.color=fg;s.font=fnt};core.comps.tree.getNodesByLevel=function(i){var r=[];var all=this.getElementsByTagName("DIV");for(var a=0;a<all.length;a++)if(all[a].domAPIObjType=="TREENODE"&&all[a].level==i)r[r.length]=all[a];return r};core.comps.tree.findNodeByName=function(n,recurse){for(var a=0;a<this.nodes.length;a++){if(this.nodes[a].getText()==n)r=this.nodes[a];else if(recurse)this.nodes[a].findNodeByName(n,true)}if(typeof r!="undefined")return r};core.comps.tree.findNodeByPath=function(n,d){d=core.rVal(d,core.comps.tree.defDelimter);var p=n.split(d);var last=p[p.length-1];if(n.charAt(0)!=d)n=d+n;var r=[];var all=this.getElementsByTagName("DIV");for(var a=0;a<all.length;a++)if(all[a].domAPIObjType=="TREENODE"&&all[a].getText()==last)r[r.length]=all[a];for(a=0;a<r.length;a++)if(r[a].getPath(d)==n)return r[a];return null};core.comps.tree.expandToPath=function(n,d){d=core.rVal(d,core.comps.tree.defDelimter);if(n.charAt(0)==d)n=n.substring(1,n.length);var p=n.split(d);var t=this;for(var a=0;a<p.length-1;a++){t=t.findNodeByName(p[a]);if(t)t.expand();else return}};core.comps.tree.attachToForm=function(f,n){this.hiddenE=core._attachToForm(f,n);this.setFormValue(this.hiddenE)};core.comps.tree.setFormValue=function(e){if(!e)return;if(!this.selected)return;e.value=this.selected.getPath()};function Treenode(arg){var p=arg.parent;if(!p){alert(core.getString("TREE_NO_PARENT"));return}var e=core.createElm(p);e.tree=p.tree;e.level=e.tree.getLevel(e);if(e.level>e.tree.maxLevel)e.tree.maxLevel=e.level;e.fn=arg.fn;e.userobj=arg;e.img=p.img;var t=e.style;t.position="relative";t.padding="0px";if(core.isIE)t.margin="-2px 0px 0px 0px";if(core.isNS)t.margin="-2px 0px 0px 0px";t.border="0px solid black";t.whiteSpace="nowrap";t.lineHeight="14px";t.display="none";e.caption=arg.caption;e.expanded=false;e.nodes=[];e.selected=false;e.onselect=function(){};e.setText('<span></span><span style="margin-left:4px;padding:0px 2px"></span>');t=core.comps.tree;e.folder=core.rInt(arg.folder,core._treeConst.MIN_F);e.add=t.add;e.addPath=t.addPath;e.setText=t._nodesetText;e.getText=t._nodegetText;e.reDraw=t._nodereDraw;e.collapse=t.collapse;e.expand=t.expand;e.toggle=t.toggle;e.popNode=t.popNode;e.getNodesByLevel=t.getNodesByLevel;e.getPath=t.getPath;e.findNodeByName=t.findNodeByName;e.setText(arg.caption);e.domAPIObjType="TREENODE";return e};core.comps.tree._nodesetText=function(c){this.childNodes[1].innerHTML=c};core.comps.tree._nodegetText=function(){return this.childNodes[1].innerHTML};core.comps.tree._nodereDraw=function(recurse){if(this.tree.quickMode)recurse=false;var i,a;var c=core._treeConst;var t=this.tree.theme;var tree=this.tree;if(tree.showSelection&&this.selected)tree.colorNode(this,t.selBgColor,t.selFgColor,t.selFont);else tree.colorNode(this,t.bgColor,t.fgColor,t.font);var lev=this.level+2;var imgs=this.childNodes[0];var folder=this.selected?c.MIN_F:c.MAX_F;if(this.folder!=c.MIN_F)folder=this.folder;if(imgs.childNodes[lev-1].index!=folder)imgs.childNodes[lev-1].setImage(folder);if(lev>1){if(this.nodes.length==0)i=this.nextSibling?c.T:c.L;else{if(this.nextSibling){i=this.expanded?c.MAX_T:c.MIN_T}else{i=this.expanded?c.MAX_L:c.MIN_L}}if(lev==2)i=this.expanded?c.MAX:c.MIN;if((i==c.MIN||i==c.MAX)&&this.nodes.length==0)i=c.BLANK;if(imgs.childNodes[lev-2].index!=i)imgs.childNodes[lev-2].setImage(i)}if(recurse)for(a=0;a<this.nodes.length;a++)this.nodes[a].reDraw(recurse)};
