// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.loadUnit('thirdparty/kalm/menuex');core.registerComponent('menubarex');function MenubarEx(arg){var bgImage=arg["bgimage"];var imgTyp=typeof(bgImage);var e=core._component(arg,"menubarex",false,'div');e.className='menu-bar';e.style.position="absolute";e.pushLevel=0;e.autoOpen=false;e.isOpen=false;e.currItem=null;e.topItem=null;e.bgImage=(imgTyp=='undefined'||bgImage==null)?"":((imgTyp=='string')?bgImage:((imgTyp=='object')?bgImage.src:""));e.guid="";e.subMenues=new Array();e.branches=new Array();core.disallowSelect(e);if(e.bgImage!=""){e.style.backgroundImage="url("+e.bgImage+")"}e.reDraw();return e};core.comps.menubarex._free=function(){var parent=this.parentNode;parent.removeChild(this);this.className=null;this.pushLevel=null;this.autoOpen=null;this.isOpen=null;this.currItem=null;this.topItem=null;this.bgImage=null;this.guid=null;this.subMenues=[];this.subMenues=null;this.branches=[];this.branches=null};core.comps.menubarex.reDraw=function(){this.menubarReDraw();this.onredraw()};core.comps.menubarex.menubarReDraw=function(){if(core.comps.menuex.useCssFile){this.guid="";this.className="menu-bar";this._redrawMenues();return}if(core.comps.menuex.usePrebuiltThemes&&core.comps.menuex._prebuiltThemesAvailable){this.guid=this.theme.name.replace(/\s/g,"");this.className=this.guid+"_menu-bar";this._redrawMenues();return}if(core.comps.menuex._useFastMode&&core.isIE){this._writeCssSection();this.guid=this.theme.guid;this.className=this.guid+"_menu-bar";this._redrawMenues();return}core.comps.menuex._updateRules(this.theme.guid,this.theme);this.guid=this.theme.guid;this.className=this.guid+"_menu-bar";this._redrawMenues()};core.comps.menubarex._writeCssSection=function(){var t=this.theme;var name=t.guid;var rules=core.comps.menuex._getComleteCss(name,t);var count=document.styleSheets.length;for(var index=0;index<count;index++){name=document.styleSheets[index].title;if(name=="internalMenuExCss"){document.styleSheets[index].cssText=rules}}};core.comps.menubarex._getTopItem=function(){if(this.branches.length>0){return this.branches[ this.branches.length-1]}return this};core.comps.menubarex._popAll=function(){if(this.branches.length>0){var item;var index;for(index=0;index<this.branches.length;index++){item=this.branches[ index ];if(null!=item.dropDown){item.dropDown.pushLevel=core.max(0,--item.dropDown.pushLevel)}}this.branches.pop()}};core.comps.menubarex._pushAll=function(){if(this.branches.length>1){var item;var index;for(index=0;index<this.branches.length-1;index++){item=this.branches[ index ];if(null!=item.dropDown){item.dropDown.pushLevel++}}}};core.comps.menubarex._open=function(newItem){var nextItem,thisItem=this.currItem;if(this.currItem!=newItem){while(null!=thisItem){thisItem._hilite(false);if(null!=thisItem.dropDown){nextItem=thisItem.dropDown.currItem;thisItem.dropDown.currItem=null;thisItem=nextItem}else thisItem=null}this.currItem=newItem;if(null==this.currItem)this._setOpen(this.autoOpen)}};core.comps.menubarex._setOpen=function(flag){this.isOpen=flag;var index=0;for(index=0;index<this.childNodes.length;index++){this.childNodes[index].autoOpen=this.isOpen}};core.comps.menubarex._redrawMenues=function(){var index;var item;for(index=0;index<this.subMenues.length;index++){item=this.subMenues[index];if(null!=item.dropDown){item.dropDown.reDraw()}}};core.comps.menubarex.add=function(caption,args){if(this.pushLevel>0){var item=this.topItem;item._addDropDown();var dropDown=item.dropDown;return dropDown.table.appendChild(MenuitemEx(dropDown,caption,false,dropDown.autoOpen,args?args:{}))}else{return this.appendChild(MenuitemEx(this,caption,false,this.autoOpen,args?args:{}))}};core.comps.menubarex.push=function(caption,args){if(this.pushLevel>0){this._pushAll();var item=this.topItem;item._addDropDown();var dropDown=item.dropDown;dropDown.pushLevel++;this.topItem=dropDown.table.appendChild(MenuitemEx(dropDown,caption,false,dropDown.autoOpen,args?args:{}))}else{this.topItem=this.appendChild(MenuitemEx(this,caption,false,this.autoOpen,args?args:{}))}this.pushLevel++;this.subMenues.push(this.topItem);this.branches.push(this.topItem);return this.topItem};core.comps.menubarex.pop=function(){if(this.pushLevel>0){this._popAll()}this.pushLevel=core.max(0,--this.pushLevel);this.topItem=this._getTopItem();return this.topItem};core.comps.menubarex.separator=function(){if(this.pushLevel>0){var item=this.topItem;item._addDropDown();var dropDown=item.dropDown;return dropDown.table.appendChild(MenuitemEx(dropDown,"",true,dropDown.autoOpen,{}))}return null};core.comps.menubarex.initMenu=function(){var index;var items=this.childNodes;for(index=0;index<items.length;index++){items[index]._OnUpdateCmdUI();items[index].reDraw()}};core.comps.menubarex.close=function(){this._open(null)};core.comps.menubarex.setBgImage=function(bgImage){var imgTyp=typeof(bgImage);this.bgImage=(imgTyp=='undefined'||bgImage==null)?"":((imgTyp=='string')?bgImage:((imgTyp=='object')?bgImage.src:""));this.style.backgroundImage="url("+this.bgImage+")"};core.comps.menubarex.applyTheme=function(theme){this.theme=core.rTheme(theme);this.reDraw()};
