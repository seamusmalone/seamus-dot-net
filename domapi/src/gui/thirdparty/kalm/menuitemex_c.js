// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.max=function(a,b){return(a>b)?a:b};core.min=function(a,b){return(a<b)?a:b};core.isDomObjType=function(obj){var typ=typeof(obj);if(null!=obj&&(typ!='undefined')&&obj.domAPIObjType){for(i=1;i<arguments.length;i++){if(obj.domAPIObjType==arguments[i]){return true}}}return false};core.trace=function(s){if(core.doDebug){core.debug.dump_var(s.replace(/\s/g,"&nbsp;"))}};core.bringUpConsole=function(){if(core.doDebug){core.debug.bringUpConsole()}};core.startProfile=function(s){if(core.doDebug){core.debug.startProfile(s.replace(/\s/g,"&nbsp;"))}};core.endProfile=function(s){if(core.doDebug){core.debug.endProfile(s.replace(/\s/g,"&nbsp;"))}};core.dump_props=function(o){if(core.doDebug){core.debug.dump_props(o)}};core.rType=function(dflt,test){var typ=typeof(test);for(i=2;i<arguments.length;i++){if(typ==arguments[i]){return test}}return dflt};core.preTransateMenuThemes=function(){var themeMaker=null;if(core.comps.menuex){themeMaker=core.comps.menuex._getComleteCss?core.comps.menuex._getComleteCss:null}if(null==themeMaker)return;core.comps.menuex._prebuiltThemesAvailable=true;core.comps.menuex.usePrebuiltThemes=true;var strCss='<style title="prebuiltMenuExCss" type="text/css">\n';var index;for(index=0;index<core.themes.length;index++){strCss+=themeMaker(core.themes[index].name,core.themes[index])}strCss+='\n</style>\n';document.writeln(strCss)};core.elmProto.hasClassAttribute=function(attr){var i,list;if(null==this.className)return false;list=this.className.split(" ");for(i=0;i<list.length;i++)if(list[i]==attr)return true;return false};core.elmProto.addClassAttribute=function(attr){if(!this.hasClassAttribute(attr)){if(null==this.className){this.className=attr}else{this.className+=' '+attr}return true}return false};core.elmProto.removeClassAttribute=function(attr){var i,curList,newList;if(this.className==null||!this.hasClassAttribute(attr))return false;newList=new Array();curList=this.className.split(" ");for(i=0;i<curList.length;i++)if(curList[i]!=attr)newList.push(curList[i]);this.className=newList.join(" ")};function MenuCmdUI(menuitem){this.caption=menuitem.caption;this.enabled=menuitem.enabled;this.itemImageSrc=menuitem.itemImageSrc;this.toolTip=menuitem.title;this.statusText=menuitem.statusText;this.checked=menuitem.checked;this.visible=menuitem.visible;this.bgImage=menuitem._getBgImage();this.flag=0;this.setCaption=function(txt){if(this.caption!=txt){this.caption=txt;this.flag|=1}};this.setEnabled=function(flag){if(this.enabled!=flag){this.enabled=flag;this.flag|=2}};this.setItemImage=function(path){if(this.itemImageSrc!=path){this.itemImageSrc=path;this.flag|=4}};this.setTooltip=function(txt){if(this.toolTip!=txt){this.toolTip=txt;this.flag|=8}};this.setStatusText=function(txt){if(this.statusText!=txt){this.statusText=txt;this.flag|=16}};this.setChecked=function(flag){if(this.checked!=flag){this.checked=flag;this.flag|=32}};this.setBgImage=function(pah){if(this.bgImage!=path){this.bgImage=path;this.flag|=64}};this.setVisible=function(flag){if(this.visible!=flag){this.visible=flag;this.flag|=128}};this._changed=function(query){return(0!=(this.flag&query))};this._isDirty=function(){return(0!=this.flag)}};core.registerComponent('menuitemex');core.comps.menuitemex.disableIfNoHandler=true;function MenuitemEx(parent,caption,isSeparator,autoOpen,arg){var itemImage=arg["image"];var isButton=core.isDomObjType(parent,'MENUBAREX');var e=document.createElement((isButton)?'SPAN':'TR');core.Elm2(e);e.className=(isButton)?"menu-button":"";e.caption=caption;e.style.position="relative";e.isButton=isButton;e.isSeparator=isSeparator;e.autoOpen=autoOpen;e.itemImageSrc="";e.onCmd=(isSeparator)?null:core.rType(null,arg["oncmd"],"function","string");e.onUpdate=(isSeparator)?null:core.rType(null,arg["onupdate"],"function");e.statusText=(isSeparator)?"":core.rType("",arg["status"],"string");e.title=(isSeparator)?"":core.rType("",arg["tooltip"],"string");e.checkbox=(isSeparator)?false:core.rType(false,arg["checkbox"],"boolean");e.radio=(isSeparator)?false:core.rType(false,arg["radio"],"boolean");e.checked=false;e.hilited=false;e.enabled=true;e.visible=true;e.locked=false;e.dropDown=null;e.parentElm=parent;e.onredraw=function(){};e.domAPIObjType="MENUITEMEX";core.disallowSelect(e);core._inherit(e,'menuitemex');core.bags.menuitemex[core.bags.menuitemex.length]=e;e._createCells();e._setItemImage(itemImage);if(!isSeparator&&core.comps.menuitemex.disableIfNoHandler&&null==e.onCmd)e._setEnabled(false);e.reDraw();return e};core.comps.menuitemex._free=function(){var parent=this.parentNode;parent.removeChild(this);if(this.isButton){}else if(this.isSeparator){this.removeChild(this.separatorCell);this.separatorCell.innerHTML="";this.separatorCell.innerText="";this.separatorCell.className=null;this.separatorCell=null}else{this.removeChild(this.shewronCell);this.removeChild(this.shortcutCell);this.removeChild(this.captionCell);this.removeChild(this.iconCell);this.shewronCell.innerHTML="";this.shewronCell.innerText="";this.shewronCell.className=null;this.shewronCell=null;this.shortcutCell.innerHTML="";this.shortcutCell.innerText="";this.shortcutCell.className=null;this.shortcutCell=null;this.captionCell.innerHTML="";this.captionCell.innerText="";this.captionCell.className=null;this.captionCell=null;this.iconCell.innerHTML="";this.iconCell.innerText="";this.iconCell.className=null;this.iconCell=null}this.className=null;this.isButton=null;this.isSeparator=null;this.caption=null;this.autoOpen=null;this.itemImageSrc=null;this.onCmd=null;this.onUpdate=null;this.statusText=null;this.title=null;this.checked=null;this.hilited=null;this.visible=null;this.locked=null;this.dropDown=null;this.parentElm=null;this.onredraw=null};core.comps.menuitemex.reDraw=function(){this.menuitemReDraw();this.onredraw()};core.comps.menuitemex.menuitemReDraw=function(){if(this.isButton){this.innerHTML="<span unselectable='on' class='left'></span><span unselectable='on' class='middle'>"+this._disabledContainer(this.caption.replace(/\s/g,"&nbsp;"))+"</span><span unselectable='on' class='right'></span>"}else if(!this.isSeparator){if(this.checkbox){this.iconCell.className="empty-icon-cell";this.iconCell.innerHTML=this._disabledContainer("<span class='check-box'>"+((this.checked)?"a":"&nbsp")+"</span>")}else if(this.radio){this.iconCell.className="empty-icon-cell";this.iconCell.innerHTML=this._disabledContainer("<span class='radio-button'>"+((this.checked)?"n":"&nbsp")+"</span>")}else{if(this.itemImageSrc!=""){this.iconCell.className="icon-cell";this.iconCell.innerHTML=this._disabledContainer("<img src='"+this.itemImageSrc+"' />")}else{this.iconCell.className="empty-icon-cell";this.iconCell.innerHTML=this._disabledContainer("<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>")}}this.captionCell.innerHTML=this._disabledContainer(this.caption.replace(/\s/g,"&nbsp;"));this.shortcutCell.innerHTML=this._disabledContainer("&nbsp;");if(null!=this.dropDown){this.shewronCell.innerHTML=this._disabledContainer("4")}}};core.comps.menuitemex._createCells=function(){if(this.isButton){this.innerHTML="<span unselectable='on' class='left'></span><span unselectable='on' class='middle'>"+this._disabledContainer(this.caption.replace(/\s/g,"&nbsp;"))+"</span><span unselectable='on' class='right'></span>"}else if(this.isSeparator){this.separatorCell=document.createElement('td');this.separatorCell.colSpan="4";this.separatorCell.innerHTML="<div class='separator-line'></div>";this.appendChild(this.separatorCell);this.className="separator"}else{this.iconCell=document.createElement('td');this.iconCell.className="empty-icon-cell";this.iconCell.innerHTML=this._disabledContainer("<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>");if(this.checkbox||this.radio){this.iconCell.innerHTML=this._disabledContainer("")}this.captionCell=document.createElement('td');this.captionCell.className="label-cell";this.captionCell.innerHTML=this._disabledContainer(this.caption.replace(/\s/g,"&nbsp;"));this.shortcutCell=document.createElement('td');this.shortcutCell.className="label-cell";this.shortcutCell.innerHTML=this._disabledContainer("&nbsp;");this.shewronCell=document.createElement('td');this.shewronCell.className="arrow-cell";this.shewronCell.innerHTML=this._disabledContainer("<span>&nbsp;</span>");this.appendChild(this.iconCell);this.appendChild(this.captionCell);this.appendChild(this.shortcutCell);this.appendChild(this.shewronCell);core.disallowSelect(this.iconCell);core.disallowSelect(this.captionCell);core.disallowSelect(this.shortcutCell);core.disallowSelect(this.shewronCell)}};core.comps.menuitemex._disabledContainer=function(s){if(!this.enabled)return "<span class='disabled-container'><span class='disabled-container'>"+s+"</span></span>";return s};core.comps.menuitemex._addDropDown=function(){if(null==this.dropDown){if(!this.isButton){this.shewronCell.innerHTML=this._disabledContainer("4")}this.dropDown=MenuEx({theme:this.parentElm.theme,x:0,y:0,parentelm:this});this.dropDown.hide();this._setEnabled(true);this.onCmd=null}};core.comps.menuitemex.onmouseover=function(e){core.preventBubble(e);window.status=this.statusText;if(!this.isSeparator&&!this.locked)this._hilite(true)};core.comps.menuitemex.onmouseout=function(e){core.preventBubble(e);window.status=""};core.comps.menuitemex.onclick=function(e){core.preventBubble(e);if(!this.isSeparator){if(null!=this.dropDown&&this.enabled&&!this.autoOpen){this._hilite(false);this.parentElm._setOpen(true);this._hilite(true)}else if(null==this.dropDown&&this.enabled){this._OnCommand()}}};core.comps.menuitemex._setCaption=function(txt){if(this.caption!=txt){this.caption=core.rType(this.caption,txt,"string")}};core.comps.menuitemex._setEnabled=function(flag){this.enabled=flag;switch(flag){case false:this.addClassAttribute("disabled");break;case true:this.removeClassAttribute("disabled");break}};core.comps.menuitemex._setItemImage=function(itemImage){if(!this.isButton&&!this.isSeparator&&!this.checkbox){var imgTyp=typeof(itemImage);var itemImageSrc=(imgTyp=='undefined'||itemImage==null)?"":((imgTyp=='string')?itemImage:((imgTyp=='object')?itemImage.src:""));if(this.itemImageSrc!=itemImageSrc){this.itemImageSrc=itemImageSrc}}};core.comps.menuitemex._setTooltip=function(txt){if(!this.isSeparator){this.title=core.rType("",txt,"string")}};core.comps.menuitemex._setStatusText=function(txt){if(!this.isSeparator){this.statusText=core.rType("",txt,"string")}};core.comps.menuitemex._setVisible=function(flag){this.visible=flag;switch(flag){case false:this.addClassAttribute("hidden");break;case true:this.removeClassAttribute("hidden");break}};core.comps.menuitemex._setChecked=function(flag){if(!this.isButton&&!this.isSeparator&&(this.checkbox||this.radio)){this.checked=core.rType(false,flag,"boolean");switch(this.checked){case true:this.addClassAttribute("checked");break;case false:this.removeClassAttribute("checked");break}}};core.comps.menuitemex._setBgImage=function(bgImage){if(null!=this.dropDown){this.dropDown.setBgImage(bgImage)}};core.comps.menuitemex._getBgImage=function(){if(null!=this.dropDown){return this.dropDown.bgImage}return ""};core.comps.menuitemex._hover=function(flag){switch(flag){case true:this.addClassAttribute(((this.enabled)?"hover":""));break;case false:this.removeClassAttribute(((this.enabled)?"hover":""));break}};core.comps.menuitemex._hilite=function(flag){switch(flag){case true:this.parentElm._open(this);if(!this.hilited&&!this.locked){if(this.autoOpen){this._hover(false);this.addClassAttribute((this.isButton)?((this.enabled)?"active":""):((this.enabled)?"hover":""));this._doPopup(this.enabled)}else this._hover(true);this.hilited=true}break;case false:this._hover(false);this.removeClassAttribute((this.isButton)?((this.enabled)?"active":""):((this.enabled)?"hover":""));this._doPopup(false);this.hilited=false;break}};core.comps.menuitemex._doPopup=function(flag){if(flag&&null!=this.dropDown&&!this.dropDown.visible()&&this.autoOpen){var maxX=core.bodyWidth();var xy=core.getTrueOffset(this);var w=0;if(this.isButton){xy[1]+=this.offsetHeight}else{xy[0]+=this.offsetWidth}this.dropDown.moveTo(xy[0],xy[1]);this.dropDown.initMenu();if(this.isButton){w=this.dropDown.offsetWidth;if(w+xy[0]>maxX){xy[0]=maxX-w;this.dropDown.moveTo(xy[0],xy[1])}}else{w=this.dropDown.offsetWidth;if(w+xy[0]>maxX){xy[0]-=this.offsetWidth;xy[0]-=w;this.dropDown.moveTo(xy[0],xy[1])}}this.dropDown.show()}else if(!flag&&null!=this.dropDown&&this.dropDown.visible()){this.dropDown.hide()}};core.comps.menuitemex._OnCommand=function(){this.locked=true;this._hilite(false);this._getRoot().close();if(null!=this.onCmd){var typ=typeof(this.onCmd);if(typ=="function"){this.onCmd()}else{eval(this.onCmd)}this._getRoot().initMenu()}else{core.trace("No handler for this item '"+this.caption+"'");alert("You need a handler for this item '"+this.caption+"'")}};core.comps.menuitemex._OnUpdateCmdUI=function(){this.locked=false;if(this.isSeparator){this._setVisible(true);return}if(this.isButton&&null==this.dropDown){this.autoOpen=true}if(null!=this.onUpdate){var cmdUI=new MenuCmdUI(this);this.onUpdate(cmdUI);if(cmdUI._isDirty()){var checker=1;for(checker=1;checker<=128;checker+=checker){if(cmdUI._changed(checker)){switch(checker){case 1:this._setCaption(cmdUI.caption);break;case 2:this._setEnabled(cmdUI.enabled);break;case 4:this._setItemImage(cmdUI.itemImageSrc);break;case 8:this._setTooltip(cmdUI.toolTip);break;case 16:this._setStatusText(cmdUI.statusText);break;case 32:this._setChecked(cmdUI.checked);break;case 64:this._setBgImage(cmdUI.bgImage);break;case 128:this._setVisible(cmdUI.visible);break}}}}}};core.comps.menuitemex._getRoot=function(){var root=this.parentElm;while(1){if(core.isDomObjType(root,"MENUBAREX")){return root}if(core.isDomObjType(root,"MENUEX")){if(core.isDomObjType(root.parentElm,"MENUITEMEX")){root=root.parentElm.parentElm}else{return root}}}return root};
