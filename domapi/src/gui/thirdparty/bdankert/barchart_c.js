// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.bags.barchart=[];core.bags.barchart.isComponent=true;core.comps.barchart=new Object;function Barchart(parent,theme,x,y,w,h){w=core.rInt(w,200);h=core.rInt(h,200);var elm=core.createElm(parent,x,y,w,h);elm.appendChild(document.createElement("DIV"));elm.appendChild(document.createElement("DIV"));elm.theme=core.rTheme(theme);elm.isChart=false;elm.isTitle=false;elm.isXAxis=false;elm.isYAxis=false;elm.isLabel=false;elm.isNames=false;elm.labelFont="arial";elm.labelSize=10;elm.lRound=1;elm.axisFont="arial";elm.axisSize=10;elm.xText="";elm.yText="";elm.lines=0;elm.lType=1;elm.lMult=0;elm.labels=0;elm.range=0;elm.data=[];elm.colors=[];elm.isColors=false;elm.isVert=true;elm.hText=false;elm.offX=0;elm.offY=0;elm.change=0;elm.g=0;var t=core.comps.barchart;elm.alG=t._alG;elm.alM=t._alM;elm.alH=t._alH;elm.alW=t._alW;elm.alN=t._alN;elm.alB=t._alB;elm.alA=t._alA;elm.sort1=t._sort1;elm.sort2=t._sort2;elm.sort3=t._sort3;elm.sort4=t._sort4;elm.vText=t._vText;elm.addChart=t._addChart;elm.addData=t._addData;elm.addTitle=t._addTitle;elm.setGrid=t._setGrid;elm.setLabels=t._setLabels;elm.setNames=t._setNames;elm.setColors=t._setColors;elm.setOrient=t._setOrient;elm.setXAxis=t._setXAxis;elm.setYAxis=t._setYAxis;elm.clearNames=t._clearNames;elm.clearTitle=t._clearTitle;elm.clearXAxis=t._clearXAxis;elm.clearYAxis=t._clearYAxis;elm.drawBars=t._drawBars;elm.drawChart=t._drawChart;elm.reDraw=t._reDraw;elm.dataSort=t._dataSort;elm.reDraw();elm.domAPIObjType="BARCHART";core.bags.barchart[core.bags.barchart.length]=elm;return elm};core.comps.barchart._sort1=function(a,b){return(a[0]>b[0])?-1:1};core.comps.barchart._sort2=function(a,b){return(a[0]<b[0])?-1:1};core.comps.barchart._sort3=function(a,b){return(a[1]<b[1])?-1:1};core.comps.barchart._sort4=function(a,b){return(a[1]>b[1])?-1:1};core.comps.barchart._alG=function(a){return Math.round((((((this.isVert)?(this.chart.getH()):(this.chart.getW()))-2)/(this.lines))*(a+1)*(10/11)-1))};core.comps.barchart._alM=function(a){return Math.round((((this.isVert)?(this.chart.getH()):(this.chart.getW()))-2)*(a/this.range))};core.comps.barchart._alH=function(){return this.chart.getY()+this.chart.getH()};core.comps.barchart._alW=function(){return(((this.isVert)?(this.chart.getW()):(this.chart.getH())-2)/(this.data.length))/2};core.comps.barchart._alN=function(a,p){return Math.round(((a*2*this.alW())+this.alW())-(p/4))};core.comps.barchart._alB=function(a){return Math.round((this.data[i][0]*((((this.isVert)?(this.chart.getH()):(this.chart.getW()))-2)/this.range))+2)};core.comps.barchart._alA=function(t){return Math.round(this.chart.getY()+this.chart.getH()*0.5-t.length*0.5*(this.axisSize-1))};core.comps.barchart._vText=function(s,o){for(var a=0;a<s.length;a++){var b=document.createElement("SPAN");if(s.substr(a,1)==" ")b.innerHTML="&nbsp;";else b.innerHTML=s.substr(a,1);b.style.display='block';o.appendChild(b)}};core.comps.barchart._addChart=function(x,y,w,h,l,q){if(this.isChart)return;q=core.rInt(q,this.lType);this.lType=q;l=core.rInt(l,this.lines);if(q==1)this.lines=l;else{this.lines=0;this.lMult=l}this.chart=core.createElm(this,x,y,w,h);this.chart.appendChild(document.createElement("DIV"));this.isChart=true;this.chart.setB(1);var w=this.chart.style;w.borderStyle=this.theme.bdrSolid;w.borderColor=this.theme.bdrColor;w.backgroundColor=this.theme.hlBgColor};core.comps.barchart._addData=function(set,name,del){if(!this.isChart)return;del=del?del:",";var bars=set.split(del);var names=name.split(del);for(i=0;i<bars.length;i++){if(parseInt(bars[i])*1.1>this.range){this.range=parseInt(bars[i])*1.1;this.change=1;if(this.lType==2)this.lines=Math.floor((this.range*0.99)/this.lMult)}var t=this.data;t[t.length]=new Array();t[t.length-1][0]=parseInt(bars[i]);t[t.length-1][1]=names[i];var bar=core.createElm(this.chart,0,0,0,0)}var q=((core.isIE50)?(100):(0));setTimeout('core.getElm("'+this.id+'").drawBars()',q)};core.comps.barchart._addTitle=function(t,x,y){if(core.isNil(t)){this.clearTitle();return}if(!this.barTitle)this.barTitle=core.createElm(this,x,y);this.isTitle=true;this.barTitle.setText(t);this.barTitle.setP(5);var w=this.barTitle.style;w.textAlign='center';w.font=this.theme.font;w.fontWeight='bold';w.color=this.theme.fgColor;w.top='10px';w.visibility='visible'};core.comps.barchart._setGrid=function(l,q){if(!this.isChart)return;q=core.rInt(q,this.lType);this.lType=q;l=core.rInt(l,this.lines);if(q==1)this.lines=l;else{this.lMult=l;this.lines=Math.floor((this.range*0.99)/this.lMult)}this.g=1;var t=this.chart.childNodes[0];var x=t.childNodes.length;if(x>0)for(var a=0;a<x;a++)t.removeChild(t.childNodes[0]);if(q==1){for(var a=0;a<l;a++){var temp=document.createElement("DIV");var w=temp.style;w.position="absolute";w.height=((this.isVert)?1:this.chart.getH())+"px";w.width=((this.isVert)?this.chart.getW():1)+"px";w.left=((this.isVert)?0:this.alG(a))+"px";w.top=((this.isVert)?(this.chart.getH()-this.alG(a)-4):0)+"px";w.backgroundColor=this.theme.ctrlFgColor;w.overflow="hidden";t.appendChild(temp)}}else{var b=[this.lMult];while(b[b.length-1]+this.lMult<(this.range*0.99))b[b.length]=b[b.length-1]+this.lMult;for(var a=0;a<b.length;a++){var temp=document.createElement("DIV");var w=temp.style;w.position="absolute";w.height=((this.isVert)?1:this.chart.getH())+"px";w.width=((this.isVert)?this.chart.getW():1)+"px";w.left=((this.isVert)?0:this.alM(b[a])-1)+"px";w.top=((this.isVert)?(this.chart.getH()-this.alM(b[a])-3):0)+"px";w.backgroundColor=this.theme.ctrlFgColor;w.overflow="hidden";t.appendChild(temp)}}};core.comps.barchart._setLabels=function(l,p,r){if(!this.isChart)return;l=core.rInt(l,this.lines);p=core.rInt(p,this.labelSize);this.labels=l;r=core.rInt(r,this.lRound);this.lRound=r;var t=this.childNodes[0];var z=t.childNodes.length;if(this.lType==2){var b=[this.lMult];while(b[b.length-1]+this.lMult<(this.range*0.99))b[b.length]=b[b.length-1]+this.lMult}if(z>0)for(var a=0;a<z;a++)t.removeChild(t.childNodes[0]);for(var a=0;a<l;a++){var temp=document.createElement("DIV");var temp2=document.createElement("DIV");var w=temp.style;w.position="absolute";w.height=((this.isVert)?1:2)+"px";w.width=((this.isVert)?2:1)+"px";w.left=((this.isVert)?(this.chart.getX()-2):(((this.lType==1)?(this.alG(a)):(this.alM(b[a])-1))+this.chart.getX()+1))+"px";w.top=((this.isVert)?(this.alH()-((this.lType==1)?(this.alG(a)):(this.alM(b[a])-1))-3):(this.alH()))+"px";w.backgroundColor=this.theme.ctrlFgColor;w.overflow="hidden";var w=temp2.style;w.position="absolute";w.height=((this.isVert)?1:20)+"px";w.width=((this.isVert)?this.chart.getX()-4:1)+"px";w.left=((this.isVert)?(0):((((this.lType==1)?(this.alG(a)):(this.alM(b[a])-1))+this.chart.getX()+1)-(p/8)))+"px";w.top=((this.isVert)?(this.alH()-((this.lType==1)?(this.alG(a)):(this.alM(b[a])-1))-5-(p/2)):(this.alH()+4))+"px";w.color=this.theme.ctrlFgColor;w.textAlign='right';w.fontFamily=this.labelFont;w.fontSize=p+"px";if(!this.isVert)w.lineHeight=(p-1)+'px';if(this.lType==1){var qq=Math.round(((this.range*(10/11))/(l)*(a+1))*Math.pow(10,r));var qw=qq.toString().substr(qq.toString().length-r,r);var g=qq.toString().substr(0,qq.toString().length-r);if(parseInt(qw)!=0&&r!=0)g+='.'+qw}else var g=b[a];if(this.isVert){temp2.innerHTML="<span>"+g+"</span>"}else if(this.hText)temp2.innerHTML=g;else{this.vText(g.toString(),temp2);if(g.toString().length*(p-1)>this.offY){this.change=1;this.offY=g.toString().length*(p-1)}}t.appendChild(temp);t.appendChild(temp2);if(temp2.childNodes[0].offsetWidth>this.offX){this.change=1;this.offX=temp2.childNodes[0].offsetWidth}}if(this.change==1){this.change=0;this.setXAxis();this.setYAxis()}if(this.g!=1)this.setGrid()};core.comps.barchart._setNames=function(p){if(!this.isChart||this.data.length==0)return;p=core.rInt(p,this.labelSize);var t=this.childNodes[1];var z=t.childNodes.length;this.clearNames();this.isNames=true;for(var a=0;a<this.data.length;a++){temp=document.createElement("DIV");var w=temp.style;w.position="absolute";w.fontSize=p+"px";w.fontFamily=this.labelFont;w.textAlign=(this.isVert)?('center'):('right');w.lineHeight=(p-1)+'px';w.top=((this.isVert)?(this.alH()):(this.chart.getY()+this.alN(a,p)))+"px";w.left=((this.isVert)?(this.chart.getX()+this.alN(a,p)-2):(0))+"px";if(!this.isVert)w.width=this.chart.getX()-4;if(!this.isVert)temp.innerHTML='<span>'+this.data[a][1]+'</span>';else if(this.hText)temp.innerHTML='<span>'+this.data[a][1]+'</span>';else{this.vText(this.data[a][1],temp);if(this.data[a][1].length*(p-1)>this.offY){this.change=1;this.offY=this.data[a][1].length*(p-1)}}t.appendChild(temp);if(!this.isVert)if(temp.childNodes[0].offsetWidth>this.offX){this.change=1;this.offX=temp.childNodes[0].offsetWidth}}if(this.change==1){this.change=0;this.setXAxis();this.setYAxis()}};core.comps.barchart._setColors=function(c,d){if(!this.isChart)return;if(c==null)this.isColors=false;else{d=d?d:",";this.colors=c.split(d);this.isColors=true}this.drawBars()};core.comps.barchart._setOrient=function(x){x=core.rInt(x,0);this.isVert=((x==0)?true:false);this.reDraw()};core.comps.barchart._setXAxis=function(t,x,y){if(core.isNil(t))t=this.xText;this.xText=t;if(this.offY==0)this.offY=this.labelSize;if(this.offX==0)this.offX=this.labelSize;if(!this.xAxis)this.xAxis=core.createElm(this,0,0);this.isXAxis=true;this.xAxis.setText('');if(this.isVert)this.xAxis.setText(t);else this.vText(t,this.xAxis);if(x)this.xAxis.setX(x);else if(this.isVert)this.xAxis.setX(this.chart.getX());else this.xAxis.setX(this.chart.getX()-this.offX-this.axisSize-4);if(y)this.xAxis.setY(y);else if(this.isVert)this.xAxis.setY(this.alH()+this.offY);else this.xAxis.setY(this.alA(t));if(this.isVert)this.xAxis.setW(this.chart.getW());else this.xAxis.setW(this.axisSize);var w=this.xAxis.style;w.textAlign='center';w.fontFamily=this.axisFont;w.fontWeight='bold';w.fontSize=this.axisSize+'px';w.color=this.theme.fgColor;w.visibility='visible'};core.comps.barchart._setYAxis=function(t,x,y){if(core.isNil(t))t=this.yText;this.yText=t;if(this.offY==0)this.offY=this.labelSize;if(this.offX==0)this.offX=this.labelSize;if(!this.yAxis)this.yAxis=core.createElm(this,0,0);this.isYAxis=true;this.yAxis.setText('');if(this.isVert)this.vText(t,this.yAxis);else this.yAxis.setText(t);if(x)this.yAxis.setX(x);else if(this.isVert)this.yAxis.setX(this.chart.getX()-this.offX-this.axisSize-4);else this.yAxis.setX(this.chart.getX());if(y)this.yAxis.setY(y);else if(this.isVert)this.yAxis.setY(this.alA(t));else this.yAxis.setY(this.alH()+this.offY+4);if(!this.isVert)this.yAxis.setW(this.chart.getW());else this.yAxis.setW(this.axisSize);var w=this.yAxis.style;w.textAlign='center';w.fontFamily=this.axisFont;w.fontWeight='bold';w.fontSize=this.axisSize+'px';w.color=this.theme.fgColor;w.visibility='visible';if(this.isVert)w.lineHeight=(this.axisSize-1)+'px'};core.comps.barchart._clearNames=function(){var t=this.childNodes[1];var z=t.childNodes.length;this.isNames=false;if(z>0)for(var a=0;a<z;a++)t.removeChild(t.childNodes[0])};core.comps.barchart._clearTitle=function(){if(!this.barTitle)return;this.barTitle.style.visibility='hidden';this.isTitle=false};core.comps.barchart._clearXAxis=function(){if(!this.xAxis)return;this.xAxis.style.visibility='hidden';this.xAxis=false};core.comps.barchart._clearYAxis=function(){if(!this.yAxis)return;this.yAxis.style.visibility='hidden';this.isYAxis=false};core.comps.barchart._drawBars=function(){if(!this.isChart)return;var t=this.data.length;for(i=0;i<t;i++){if(this.isColors)var a=this.colors[i%this.colors.length];else var a=this.theme.selBgColor;if(a=='theme')a=this.theme.selBgColor;var w=this.chart.childNodes[i+1];w.setB(1);w.setW((this.isVert)?(this.alW()):(this.alB(i)-1));w.setH((this.isVert)?(this.alB(i)):(this.alW()));w.setX((this.isVert)?(Math.round(((i)*2*(this.alW()))+(this.alW()/2))):(-1));w.setY((this.isVert)?((this.chart.getH()-2)-(this.alB(i))+1):(Math.round(((i)*2*(this.alW()))+(this.alW()/2))));w.setZ(1);w.setBgColor(a);w.style.borderStyle=this.theme.bdrSolid;w.style.borderColor=this.theme.ctrlFgColor}var q=((core.isIE50)?(100):(0));if(this.labels>0)this.setLabels();if(this.isNames)setTimeout('core.getElm("'+this.id+'").setNames()',q)};core.comps.barchart._drawChart=function(){this.chart.setB(1);var w=this.chart.style;w.backgroundColor=this.theme.hlBgColor;w.borderColor=this.theme.bdrColor;for(var a=0;a<this.lines;a++)this.chart.childNodes[0].childNodes[a].style.backgroundColor=this.theme.ctrlFgColor;this.setGrid();this.drawBars();if(this.xAxis)this.setXAxis();if(this.yAxis)this.setYAxis()};core.comps.barchart._reDraw=function(){this.offX=0;this.offY=0;this.setB(this.theme.bdrWidth);var w=this.style;w.backgroundColor=this.theme.ctrlBgColor;w.color=this.theme.ctrlFgColor;w.borderColor=this.theme.bdrColor;w.borderStyle=this.theme.bdrSolid;if(this.barTitle)this.barTitle.style.color=this.theme.fgColor;if(this.isChart)this.drawChart();if(typeof this.onredraw=="function")this.onredraw()};core.comps.barchart._dataSort=function(t){this.data=this.data.sort(eval('this.sort'+t))};
