// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.loadUnit("animate");core.registerComponent("collapsetree");function Collapsetree(arg){var e=core._component(arg,"collapsetree");e.speed=1;e.animate=true;e.type=1;e.indent=15;e.setP(5);e.setOverflow("auto");core.disallowSelect(e);e.reDraw();return e};core.comps.collapsetree.reDraw=function(){this.collapsetreeReDraw();this.onredraw()};core.comps.collapsetree.collapsetreeReDraw=function(){var t=this.theme;this.setB(t.bdrWidth);this.style.borderStyle=this.doBorder?t.bdrSolid:"none";this.style.borderColor=t.getInset();this.reDrawItem(this)};core.comps.collapsetree.itemHeight=function(n){var r=0;for(var a=1;a<n.childNodes.length;a++){if(n.childNodes[a].getH)r+=n.childNodes[a].getH();r+=this.itemHeight(n.childNodes[a])}return r};core.comps.collapsetree.itemClick=function(e){if(this.domAPIObjType!='COLLAPSETREE_ITEM')return;core.preventBubble(e);var p=core.findTarget(e,"COLLAPSETREE");if(this.childNodes.length>1&&p.enabled){if(!this.childNodes[1].visible){this.expanded+=this.childNodes.length-1;if(!this.isRoot){var r=this;for(var a=0;a<this.depth;a++){r=r.parentElement;if(!r)break;r.expanded+=this.expanded;if(p.animate)r.sizeTo(r.getW(),r.baseH*(r.expanded+1),p.type,Math.round(this.baseH*(this.expanded+1)*0.1*p.speed),50);else r.setSize(r.getW(),r.baseH*(r.expanded+1))}}if(p.animate)this.sizeTo(this.getW(),this.baseH*(this.expanded+1),p.type,Math.round(this.baseH*(this.expanded+1)*0.1*p.speed),50);else this.setSize(this.getW(),this.baseH*(this.expanded+1));this.childNodes[1].visible=true}else{if(p.animate)this.sizeTo(this.getW(),this.baseH,p.type,Math.round(this.baseH*(this.expanded+1)*0.1*p.speed),50);else this.setSize(this.getW(),this.baseH);if(!this.isRoot){var r=this;for(var a=0;a<this.depth;a++){r=r.parentElement;if(!r)break;r.expanded-=this.expanded;if(p.animate)r.sizeTo(r.getW(),r.baseH*(r.expanded+1),p.type,Math.round(this.baseH*(this.expanded+1)*0.1*p.speed),50);else r.setSize(r.getW(),r.baseH*(r.expanded+1))}}this.expanded-=(this.childNodes.length-1);this.childNodes[1].visible=false}}else{if(this.fn){if(this.target){switch(this.target){case "_blank":open(this.fn);break;case "_self":document.location=this.fn;break;default:eval(this.target+".document.location='"+this.fn+"'")}}else eval(this.fn)}}};core.comps.collapsetree.reDrawItem=function(e){var t=this.theme;var s=e.style;s.font=t.font;e.baseH=e.getH();e.setBgColor(this.doBGFill?t.bgColor:"transparent");e.setColor(t.fgColor);if(!this.doBGFill){s.marginTop="1px";s.marginBottom="1px"}if(e!=this)s.borderColor=s.backgroundColor;if(e!=this&&!this.doBGFill)s.borderStyle="none";for(var a=0;a<e.childNodes.length;a++)if(e.childNodes[a].domAPIObjType!=null)this.reDrawItem(e.childNodes[a])};core.comps.collapsetree.onmouseover=function(E){if(!this.doRollover||!this.enabled)return;var e=core.findTarget(E,"COLLAPSETREE_CAPTION");if(!e)return;var s=e.style;s.marginTop="0px";s.marginBottom="0px";if(!this.doBGFill)s.paddingLeft="2px";s.borderStyle="solid";s.backgroundColor=this.theme.ctrlBgColor;s.borderColor=this.theme.appBgColor};core.comps.collapsetree.onmouseout=function(E){var e=core.findTarget(E,"COLLAPSETREE_CAPTION");if(!e)return;var s=e.style;s.backgroundColor=this.doBGFill?this.style.backgroundColor:"transparent";s.borderColor=this.doBGFill?this.style.backgroundColor:"transparent";if(!this.doBGFill){s.borderStyle="none";s.marginTop="1px";s.marginBottom="1px";s.paddingLeft="3px"}};core.comps.collapsetree.addPath=function(p,fn,target,del){var a,b,found,e,s,last;var r=this;p=p.split(core.rVal(del,"|"));for(a=0;a<p.length;a++){found=false;for(b=0;b<r.childNodes.length;b++){s=r.childNodes[b];if(s.getText)if(s.getText&&s.getText()==p[a]){r=r.childNodes[b];found=true;break}}if(!found){last=a==(p.length-1);r=this.add(r,p[a],last?fn:null,last?target:null)}}};core.comps.collapsetree.add=function(p,c,fn,target){var e=core.createElm(p);e.setBgColor(this.style.backgroundColor);e.setText("<div>"+c+"</div>");e.caption=c;var n=e.childNodes[0];core.Elm2(n);n.domAPIObjType="COLLAPSETREE_CAPTION";n.style.padding="1px 3px";n.style.border="1px solid "+this.style.backgroundColor;e.isRoot=p==this;e.depth=this.getLevel(e);if(e.depth>0)e.setM([0,0,0,this.indent]);e.style.cursor=core.cursors.hand;e.setOverflow("hidden");e.domAPIObjType="COLLAPSETREE_ITEM";e.visible=e.isRoot;e.baseH=e.getH();e.setSize(e.getW(),e.baseH);e.expanded=0;e.fn=fn;e.target=target;var t=core.comps.collapsetree;e.setText=t._nodesetText;e.getText=t._nodegetText;e.getPath=t.getPath;e.onclick=t.itemClick;return e};core.comps.collapsetree.getPath=function(d){d=core.rVal(d,"/");var r=d+this.getText();var p=this.parentNode;if(!p)return r;while(true)if(p.domAPIObjType=="COLLAPSETREE")return r;else{r=d+p.getText()+r;p=p.parentNode}return null};core.comps.collapsetree.getLevel=function(n){if(!n||!n.parentNode)return 0;var r=0;var p=n.parentNode;while(p){if(p.domAPIObjType=="COLLAPSETREE")return r;else{if(p.domAPIObjType=="COLLAPSETREE_ITEM")r++;p=p.parentNode}}return r};core.comps.collapsetree._nodesetText=function(c){this.caption=c;this.childNodes[0].innerHTML=c};core.comps.collapsetree._nodegetText=function(){return this.caption};
