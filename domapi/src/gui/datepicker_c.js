// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.loadUnit("dropdown");core.loadUnit("calendar");core.registerComponent("datepicker");core.datepickerShared={};function Datepicker(arg){arg.w=150;arg.h=22;var e=core._component(arg,"datepicker",true);core._inherit(e,"dropdown");e.pathToButtons=core.rVal(arg["pathToButtons"],core.imagePath+"buttons/");e._constructor(e.pathToButtons);core._inherit(e,"datepicker");e.value=core.rVal(arg["date"],sysutils.now());e.edit.value=sysutils.formatDate(e.value);e.valueStr=core.createElm(e,0,0,100,100);e.allowEdit=true;e.valueStr.setText(e.edit.value);e.valueStr.hide();e.dateMask=sysutils.defaultDateMask;e.dropDown=Calendar({x:0,y:e.getH(),date:e.value,pathToButtons:e.pathToButtons});e.dropDown.parent=e;e.dropDown.hide();e.dropDown.hideTitle();var t=core.datepickerShared;e.dropDown.onbeforechange=t._onbeforechange;e.dropDown.onchange=t._onchange;e.edit.onchange=t._eonchange;e.onbtnclick(false);e.reDraw();return e};core.comps.datepicker.reDraw=function(){this.dropdownReDraw();this.datepickerReDraw();this.onredraw()};core.comps.datepicker.datepickerReDraw=function(){this.dropDown.theme=this.theme;this.dropDown.reDraw();var v=this.valueStr;var t=this.theme;v.setB(core.rInt(t.bdrWidth,1));v.setP([2,0,0,2]);var b=core.isIE?b=[0,0,0,0]:v.getB();var p=core.isIE?p=[0,0,0,0]:v.getP();v.style.font=t.font;v.style.borderStyle=t.bdrSolid;v.style.borderColor=t.getInset();v.setSize(this.getW()-this.dropBtn.getW()-b[1]-b[3]+p[3],this.getH()-b[0]-b[2]+p[0]);v.setColor(t.fgColor);v.setBgColor(t.bgColor)};core.comps.datepicker.onbtnclick=function(b){this.dropDown.monthCB.valueStr.style.visibility=b?"visible":"hidden"};core.comps.datepicker.setEnabled=function(b){this.rootSetEnabled(b);this.dropDown.setEnabled(b)};core.comps.datepicker.setDoRollover=function(b){this.rootSetDoRollover(b);this.dropDown.setDoRollover(b)};core.comps.datepicker.setDateFormat=function(m){this.dateMask=m;this.edit.value=sysutils.formatDate(this.value,this.dateMask)};core.comps.datepicker.setAllowEdit=function(b){if(!b){this.edit.hide();this.valueStr.show();if(core.isNil(this.value)&&(this.dropDown.items.length>0)){this.dropDown.selectItem(0);this.dropBtn.onclick()}}else{this.edit.show();this.valueStr.hide()}this.allowEdit=b};core.datepickerShared._onbeforechange=function(v){return this.parent.onbeforechange(v)};core.datepickerShared._onchange=function(c){var r=this.parent;r.value=this.date;r.edit.value=sysutils.formatDate(r.value,r.dateMask);r.valueStr.setText(r.edit.value);if(r.autoClose&&r.opened&&c)r.dropBtn.onclick();r._onchange()};core.datepickerShared._eonchange=function(){var r=this.parentNode;var nd=sysutils.isDate(this.value,r.dateMask);if(!nd)return;r.value=nd;r.edit.value=sysutils.formatDate(r.value,r.dateMask);r._onchange();r.dropDown.setDate(r.value)};
