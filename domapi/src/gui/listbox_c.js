// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.loadUnit("nodesort");core.registerComponent("listbox");function Listbox(arg){var e=core._component(arg,"listbox");e.items=e.childNodes;e.multiSelect=false;e.selected=[];e.hLines=true;e.allowNoSelect=false;e.showSelection=true;e.doFade=false;e.ledgerMode=false;e.ledgerC1="#FFFFB9";e.ledgerC2="#E8FFEA";e.onchange=function(i){};e.onbeforechange=function(i){return true};e.setOverflow("auto");e.reDraw();return e};core.comps.listbox.reDraw=function(){this.listboxReDraw();this.onredraw()};core.comps.listbox.listboxReDraw=function(){this.setB(this.theme.bdrWidth);this.setColor(this.theme.fgColor);this.setBgColor(this.doBGFill?this.theme.bgColor:"transparent");var t=this.style;t.borderStyle=this.doBorder?this.theme.bdrSolid:"none";t.borderColor=this.theme.getInset();t.cursor="default";t.scrollbarBaseColor=this.theme.ctrlBgColor;for(var a=0;a<this.items.length;a++)this.redrawItem(this.items[a])};core.comps.listbox.findItemColor=function(item){if(item.selected&&this.showSelection)return this.theme.selBgColor;else if(!this.ledgerMode)return this.style.backgroundColor;else return(core.getNodeIndex(item)%2)==0?this.ledgerC1:this.ledgerC2};core.comps.listbox.redrawItem=function(sent){var bgc=this.findItemColor(sent);if(this.doFade&&sent.selected)core.color.fadeToColor(sent.id,"bg",bgc,this.theme.colorFadeInc,this.theme.colorFadeSpeed);else sent.style.backgroundColor=bgc;var fgc=(sent.selected&&this.showSelection)?this.theme.selFgColor:this.theme.fgColor;if(this.doFade&&sent.selected)core.color.fadeToColor(sent.id,"fg",fgc,this.theme.colorFadeInc,this.theme.colorFadeSpeed);else sent.style.color=fgc;sent.style.font=(sent.selected&&this.showSelection)?this.theme.selFont:this.theme.font;sent.style.borderColor=this.theme.ctrlBgColor;sent.style.borderWidth="0px";if(this.hLines)sent.style.borderBottomWidth="1px"};core.comps.listbox.addItem=function(key,value,fn){var temp=document.createElement("DIV");temp.id=this.id+"_"+this.items.length;temp.innerHTML=key;temp.fn=fn;temp.selected=false;temp.style.borderStyle="solid";temp.style.padding="0px 5px";temp.style.cursor="default";temp.key=key;temp.value=value;core.disallowSelect(temp);this.appendChild(temp);if(this.items.length==1&&!this.allowNoSelect){this.items[0].selected=true;this.selected[0]=this.items[0];temp.style.backgroundColor=this.theme.selBgColor;temp.style.color=this.theme.selFgColor;temp.selected=true}this.redrawItem(temp);this.setFormValue(this.hiddenE)};core.comps.listbox.setBorderOut=function(sent){sent.style.borderWidth="0px 0px 1px 0px"};core.comps.listbox.setBorderIn=function(sent){sent.style.borderWidth="1px 0px 0px 0px"};core.comps.listbox.onmouseover=function(e){if(!this.doRollover||!this.enabled)return;var temp=core.findTarget(e,"DIV");if(!temp||temp==this)return;if(temp.selected)return;temp.style.font=this.theme.hlFont;if(this.doFade)core.color.fadeToColor(temp.id,"fg",this.theme.hlFgColor,this.theme.colorFadeInc,this.theme.colorFadeSpeed);else temp.style.color=this.theme.hlFgColor;if(this.doFade)core.color.fadeToColor(temp.id,"bg",this.theme.hlBgColor,this.theme.colorFadeInc,this.theme.colorFadeSpeed);else temp.style.backgroundColor=this.theme.hlBgColor};core.comps.listbox.onmouseout=function(e){if(!this.enabled||!this.doRollover)return;var temp=core.findTarget(e,"DIV");if(!temp||temp==this)return;if(temp.selected)return;temp.style.font=this.theme.font;if(this.doFade)core.color.fadeToColor(temp.id,"fg",this.theme.fgColor,this.theme.colorFadeInc,this.theme.colorFadeSpeed);else temp.style.color=this.theme.fgColor;if(this.doFade)core.color.fadeToColor(temp.id,null,this.findItemColor(temp),this.theme.colorFadeInc,this.theme.colorFadeSpeed);else temp.style.backgroundColor=this.findItemColor(temp)};core.comps.listbox.onmousedown=function(e){if(!this.enabled||!this.doDepress)return;var temp=core.findTarget(e,"DIV");if(!temp||temp==this)return;this.setBorderIn(temp)};core.comps.listbox.onmouseup=function(e){var temp=core.findTarget(e,"DIV");if(!temp||temp==this)return;if(!this.enabled)return;if(this.doDepress)this.setBorderOut(temp);this.selectItem_p(temp)};core.comps.listbox.findItem=function(s,ignoreCase){var temp="";if(ignoreCase)s=s.toLowerCase();for(var a=0;a<this.items.length;a++){temp=this.items[a].innerHTML;if(ignoreCase)temp=temp.toLowerCase();if(s==temp)return this.items[a]}return null};core.comps.listbox.setItem=function(i,key,value,fn){if(i>=this.items.length)return;with(this.items[i]){innerHTML=key;fn=fn;key=key;value=value}this.setFormValue(this.hiddenE)};core.comps.listbox.sortItems=function(dir,type){core.nodesort.nodeSort(this.items,dir,type)};core.comps.listbox.deleteItem=function(i){if(i>=this.items.length)return;var e=this.items[i];var s=this.selected;for(var a=s.length-1;a>=0;a--)if(s[a]==e)s.deleteItem(a);this.removeChild(e);this.setFormValue(this.hiddenE);this.onchange()};core.comps.listbox.clearItems=function(){for(var a=this.items.length-1;a>-1;a--)this.deleteItem(a);this.setFormValue(this.hiddenE)};core.comps.listbox.selectItem=function(i){if(i>=this.items.length)return false;if(i>-1)this.selectItem_p(this.items[i]);else{var s=this.selected;for(var a=s.length-1;a>=0;a--){s[a].selected=false;this.redrawItem(s[a]);s.deleteItem(a);this.setFormValue(this.hiddenE)}}};core.comps.listbox.selectItem_p=function(p){function deSelect(t,e){for(var a=t.selected.length-1;a>=0;a--)if(t.selected[a]==e)t.selected.deleteItem(a);e.selected=false;t.redrawItem(e)};if(!p){this.setFormValue(this.hiddenE);return false}var was=p.selected;if(!this.allowNoSelect&&p.selected&&this.selected.length==1){this.setFormValue(this.hiddenE);return}if(!was&&!this.onbeforechange(p)){this.setFormValue(this.hiddenE);return}if(this.multiSelect){if(p.selected){deSelect(this,p)}else{this.selected[this.selected.length]=p;p.selected=true}}else{for(var a=this.selected.length-1;a>=0;a--)deSelect(this,this.selected[a]);if((!this.allowNoSelect&&was)||!was){this.selected[this.selected.length]=p;p.selected=true}}this.redrawItem(p);if(p.selected&&p.fn)eval(p.fn);this.setFormValue(this.hiddenE);this.onchange(p)};core.comps.listbox.delimitedText=function(s,del){del=core.rVal(del,",");this.clearItems();var list=s.split(del);for(var a=0;a<list.length;a++)this.addItem(list[a]);this.setFormValue(this.hiddenE)};core.comps.listbox.attachToForm=function(f,n){this.hiddenE=core._attachToForm(f,n);this.setFormValue(this.hiddenE)};core.comps.listbox.setFormValue=function(e){if(!e)return;var t="";var s=this.selected;for(var a=0;a<s.length;a++){if(a>0)t=t+"\n";t=t+s[a].key+"="+s[a].value}e.value=t};
