// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.loadUnit("headerbar");core.loadUnit("grid");core.registerComponent("listgrid");function Listgrid(arg){var e=core._component(arg,"listgrid",true);core._inherit(e,"grid");e._headerbar=Headerbar({parent:e,h:arg.headerH});e._grid=Grid({parent:e,noInherit:true,w:300,h:300});if(arg.hasFooter){e._footerbar=Headerbar({parent:e,h:arg.headerH});var f=e._footerbar;f.doColSort=false;f.doColResize=false;f.doColMove=false}var g=e._grid;var h=e._headerbar;g.addCol=e.addCol;g._setColAlign=e._setColAlign;g.setColCSS=e.setColCSS;g._setColCSS=e._setColCSS;core._inherit(e,"listgrid");g.doBorder=false;e.doSort=true;e.doResize=true;e.doMove=true;e.selected=[];e.rows=g.rows;e.cols=g.cols;e.doThumbTracking=!core.isNS;e.style.overflow="hidden";h.onresizing=function(i,w){var p=this.parentNode;if(!p.doThumbTracking)return;if(p._footerbar)p._footerbar.cols[i].setAttribute("width",w);if(i==0)w+=this.theme.bdrWidth;p._grid.ctrlRow.cells[i].setAttribute("width",w)};e.onchange=function(){};h.onsort=function(i,dir){this.parentNode._sortCol(i,dir)};h.onresized=function(i,w){var p=this.parentNode;var f=p._footerbar;if(core.isNS)p._syncHeadCols();p.syncScroll();var g=p._grid;this.setW(g.scrollWidth+(g.getW()-g.clientWidth));w=this.getW();if(f)f.setW(w);p.syncCols()};h.oncolswap=function(i,j){this.parentNode.swapCols(i,j,true)};g.onscroll=function(E){if(core.isNS)window.setTimeout('core.comps.listgrid.syncScroll(\''+g.parentNode.id+'\')',10);else this.parentNode.syncScroll()};e.reDraw();return e};core.comps.listgrid.reDraw=function(){this.listgridReDraw();this.onredraw()};core.comps.listgrid.listgridReDraw=function(){var t=this.theme;var s=this.style;var g=this._grid;var h=this._headerbar;var b=t.bdrWidth;this.setB(b);s.borderStyle=this.doBorder?t.bdrSolid:"none";s.borderColor=t.getInset();s.backgroundColor=this.doBGFill?t.bgColor:"transparent";s.color=t.fgColor;t.margin="0px";t.padding="0px";t.fontFamily='"MS Sans Serif",Geneva,sans-serif';t.fontSize="8pt";s.scrollbarBaseColor=t.ctrlBgColor;h.theme=t;h.reDraw();g.theme=t;g.doBGFill=this.doBGFill;g.doHLines=this.doHLines;g.doVLines=this.doVLines;this._layout();this.gridReDraw();this.syncCols();h.setW(this.clientWidth+g.clientWidth)};core.comps.listgrid._layout=function(){var g=this._grid;var b=core.rInt(this.theme.bdrWidth)*(core.isIE?2:0);var f=this._footerbar;g.setW(this.getW()-b);g.setH(this.getH()-b-this._headerbar.getH()-((!f)?0:f.getH()))};core.comps.listgrid._syncHeadCols=function(){var h=this._headerbar;var f=this._footerbar;var g=this._grid;var w=h.row.parentNode.parentNode.getAttribute("width");g.table.parentNode.setAttribute("width",w);if(core.isNS)h.setW(g.scrollWidth+(g.getW()-g.clientWidth));if(f)f.row.parentNode.parentNode.setAttribute("width",w)};core.comps.listgrid.syncCols=function(){var h=this._headerbar;var f=this._footerbar;var r=this._grid.ctrlRow;var w;if(core.isNS)this._syncHeadCols();for(var a=0;a<r.cells.length;a++){w=parseInt(h.cols[a].getAttribute("width"));if(f)f.cols[a].setAttribute("width",w);if(a==0)w+=this.theme.bdrWidth;this.setColW(a,w)}};core.comps.listgrid.syncScroll=function(id){var p=id?core.Elm(id):this;var f=this._footerbar;var s=-p._grid.scrollLeft;p._headerbar.style.left=s;if(f)f.style.left=s};core.comps.listgrid.addCol=function(arg){var g=this._grid;var h=this._headerbar;var f=this._footerbar;arg.w=core.rInt(arg.w);h.addCol(arg);g.addCol(arg);if(f){arg.caption='';f.addCol(arg)};if(core.isNS)this._syncHeadCols();h.setW(g.scrollWidth+(g.getW()-g.clientWidth));if(f)f.setW(h.getW());this.syncCols()};core.comps.listgrid.allowRollover=function(b){var f=this._footerbar;this.doRollover=b;this._headerbar.doRollover=b;if(f)f.doRollover=b;this._grid.doRollover=b};core.comps.listgrid.setEnabled=function(b){var f=this._footerbar;this.enabled=b;this._grid.enabled=b;this._headerbar.enabled=b;if(f)f.enabled=b};core.comps.listgrid.showHeader=function(b){this._headerbar.style.display=b?"":"none"};core.comps.listgrid.showFooter=function(b){var f=this._footerbar;if(f)f.style.display=b?"":"none"};core.comps.listgrid.allowResize=function(b){this.doResize=b;this._headerbar.allowResize(b)};core.comps.listgrid.allowMove=function(b){this.doMove=b;this._headerbar.allowMove(b)};core.comps.listgrid.allowSort=function(b){this.doSort=b;this._headerbar.doColSort=b};core.comps.listgrid.swapCols=function(i,j,fromH){var f=this._footerbar;if(!fromH)this._headerbar.swapCols(i,j);else{this._swapCols(i,j);if(f)f.cols[i].swapNode(f.cols[j])}if(core.isNS)this.syncCols()};core.comps.listgrid.sortCol=function(i,dir){this._headerbar.sortCol(i,dir);this._sortCol(i,dir)};core.comps.listgrid.hideCol=function(i){var f=this._footerbar;this._headerbar.hideCol(i);if(f)f.hideCol(i);this._hideCol(i);this._grid.ctrlRow.cells[i].style.display="none";if(core.isNS)this.syncCols()};core.comps.listgrid.showCol=function(i){var f=this._footerbar;this._headerbar.showCol(i);if(f)f.showCol(i);this._showCol(i);this._grid.ctrlRow.cells[i].style.display="inline";if(core.isNS)this.syncCols()};core.comps.listgrid.deleteCol=function(i){var f=this._footerbar;this._headerbar.deleteCol(i);if(f)f.deleteCol(i);this._deleteCol(i)};core.comps.listgrid.deleteCols=function(){var f=this._footerbar;this._headerbar.deleteCols();if(f)f.deleteCols();this._deleteCols()};core.comps.listgrid.clearArrows=function(){this._headerbar.clearArrows()};core.comps.listgrid.fastLoad=function(ihtml){this._fastLoad(ihtml);var g=this._grid;g.ctrlRow=g.table.childNodes.item(0);g.cols=g.ctrlRow.cells;this.rows=g.rows;this.cols=g.cols;this.syncCols()}
