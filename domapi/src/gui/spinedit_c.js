// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.loadUnit("speedbutton");core.loadUnit("sysutils");core.registerComponent("spinedit");function Spinedit(arg){arg.w=core.rInt(arg.w,100);arg.h=core.rInt(arg.h,22);var e=core._component(arg,"spinedit");e.pathToButtons=core.rVal(arg.pathToButtons,core.imagePath+"buttons/");e.edit=core.createElm(e,0,0,100,100,null,null,"INPUT");e.onbeforechange=function(v){return true};e.onchange=function(v){};e.edit.value=core.rInt(arg.value,0);e.buttonWidth=18;e.upBtn=Speedbutton({parent:e,img:e.pathToButtons+'spinup1.gif',x:0,y:0,w:e.buttonWidth,h:10,imgCount:1,imgW:7,imgH:4});e.downBtn=Speedbutton({parent:e,img:e.pathToButtons+'spindown1.gif',x:0,y:0,w:e.buttonWidth,h:10,imgCount:1,imgW:7,imgH:4});e.step=1;e.value=parseInt(e.edit.value);e.min=0;e.max=1000;e.doWarning=true;e._mouseheldTimer=null;e._mouserevolveTimer=null;e.holdInterval=500;e.revolveInterval=100;var p=core.isIE?(core.isStrict?"5px":"7px"):("14px");e.upBtn .cell.style.paddingLeft="0px";e.upBtn .cell.style.paddingTop=p;e.downBtn.cell.style.paddingLeft="0px";e.downBtn.cell.style.paddingTop=p;e.upBtn ._dir=1;e.downBtn._dir=-1;var t=core.comps.spinedit;e.upBtn.onfocus=t._onfocus;e.downBtn.onfocus=t._onfocus;e.edit.onchange=t._onchange;e.edit.onkeyup=t._onchange;core.addEvent(e.upBtn,"mouseup",t._mouseup);core.addEvent(e.upBtn,"mousedown",t._mousedown);core.addEvent(e.upBtn,"mouseout",t._mouseout);core.addEvent(e.downBtn,"mouseup",t._mouseup);core.addEvent(e.downBtn,"mousedown",t._mousedown);core.addEvent(e.downBtn,"mouseout",t._mouseout);e.reDraw();return e};core.comps.spinedit.reDraw=function(){this.spineditReDraw();this.onredraw()};core.comps.spinedit.spineditReDraw=function(){var t=this.edit;t.setB(core.rInt(this.theme.bdrWidth,1));t.setP([2,0,0,2]);var b=core.isIE?b=[0,0,0,0]:t.getB();var p=core.isIE?p=[0,0,0,0]:t.getP();t.style.font=this.theme.font;t.setBgColor(this.theme.bgColor);t.setColor(this.theme.fgColor);t.style.borderStyle=this.theme.bdrInset;t.style.borderColor=this.theme.bdrColor;t.setSize(this.getW()-this.buttonWidth+b[1]+b[3]+p[3],this.getH()+b[0]+b[2]+p[0]);t=this.upBtn;t.theme=this.theme;t.theme.bdrWidth=1;t.moveTo(this.edit.getW(),0);t.setSize(this.buttonWidth,this.getH()/2);t.reDraw();t=this.downBtn;t.theme=this.theme;t.theme.bdrWidth=1;t.moveTo(this.edit.getW(),this.getH()/2);t.setSize(this.buttonWidth,this.getH()/2);t.setVerticalAlign("middle");t.setTextAlign("center");t.reDraw()};core.comps.spinedit.attachToForm=function(f,n){this.hiddenE=core._attachToForm(f,n,this.value)};core.comps.spinedit._onfocus=function(){this.blur()};core.comps.spinedit.setEnabled=function(b){this.enabled=b;this.upBtn.enabled=b;this.downBtn.enabled=b;this.edit.disabled=!b};core.comps.spinedit.setDoRollover=function(b){this.doRollover=b;this.upBtn.doRollover=b;this.downBtn.doRollover=b};core.comps.spinedit.setValue=function(i,skip){if(!sysutils.isInteger(i))return false;if(!this.onbeforechange(i))return false;if(i<this.min||i>this.max){if(this.doWarning)alert("Range must be between "+this.min+" and "+this.max+".");if(i<this.min)this.edit.value=this.min;if(i>this.max)this.edit.value=this.max;return false}else{this.value=i;if(this.edit.value!=i)this.edit.value=i;if(this.hiddenE)this.hiddenE.value=this.value;this.onchange(i);return true}};core.comps.spinedit._onchange=function(){if(!sysutils.isInteger(this.value))this.value=this.parentNode.value;else if(!this.parentNode.setValue(this.value))this.value=this.parentNode.value};core.comps.spinedit._mousedown=function(E){var e=core.findTarget(E,"SPEEDBUTTON");if(!e)return;var p=e.parentNode;if(!p.enabled)return;var a=parseInt(p.value)+parseInt(p.step)*e._dir;if(a>=p.min&&a<=p.max)p.setValue(a);core.comps.spinedit.activeControl=p;core.comps.spinedit.activeDir=e._dir;p._mouseheldTimer=setTimeout("core.comps.spinedit._mouseheld()",p.holdInterval)};core.comps.spinedit._mouseup=function(E){var e=core.findTarget(E,"SPEEDBUTTON");if(!e)return;var p=e.parentNode;if(!p.enabled)return;clearTimeout(p._mouseheldTimer);clearTimeout(p._mouserevolveTimer)};core.comps.spinedit._mouseout=function(E){var e=core.findTarget(E,"SPEEDBUTTON");if(!e)return;var p=e.parentNode;clearTimeout(p._mouseheldTimer);clearTimeout(p._mouserevolveTimer)};core.comps.spinedit._mouseheld=function(){var p=this.activeControl;p._mouserevolveTimer=setInterval("core.comps.spinedit._mouserevolve()",p.revolveInterval)};core.comps.spinedit._mouserevolve=function(){var p=this.activeControl;var _dir=this.activeDir;var a=parseInt(p.value)+parseInt(p.step)*_dir;if(a>=p.min&&a<=p.max)p.setValue(a)};
