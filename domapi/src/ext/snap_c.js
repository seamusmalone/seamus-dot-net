// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.loadUnit("collision");core.snap=new Object();core.snap.grid=25;core.snap.on=function(){core.elmProto.regHook('moveTo',core.snap._snapXY)};core.snap.off=function(){core.elmProto.unRegHook('moveTo',core.snap._snapXY)};core.snap.setGrid=function(g){core.snap.grid=g};core.snap._snapXY=function(e){if(e.collisionOccured)e.collisionOccured=false;else{var x=e.getX()-e.getX()%core.snap.grid;var y=e.getY()-e.getY()%core.snap.grid;e.setX(x);e.setY(y)}};core.snap.collOn=function(){core.elmProto.regHook('moveTo',core.snap.checkCollision)};core.snap.collOff=function(){core.elmProto.unRegHook('moveTo',core.snap.checkCollision)};core.snap.checkCollision=function(e){var a=e.hasHit('all');if(a[0][0]){core.snap._snapToElm(e,a[0][0]);e.collisionOccured=true}};core.snap._snapToElm=function(s,t){var a=core.snap;var sX,sY,sW,sH,tX,tY,tW,tH;sX=s.getX();sY=s.getY();sW=s.getW();sH=s.getH();tX=t.getX();tY=t.getY();tW=t.getW();tH=t.getH();var cX=sX+(sW/2);var cY=sY+(sH/2);var centerIn=false;if(a._isIn(t,cX,cY))centerIn=true;if(a._isIn(t,sX,sY)&&a._isIn(t,sX,sY+sH)&&!(a._isIn(t,sX+sW,sY))&&!(a._isIn(t,sX+sW,sY+sH)))core.snap._alignLeftToRight(t,s);else if(!(a._isIn(t,sX,sY))&&!(a._isIn(t,sX,sY+sH))&&(a._isIn(t,sX+sW,sY))&&(a._isIn(t,sX+sW,sY+sH)))core.snap._alignRightToLeft(t,s);else if((a._isIn(t,sX,sY))&&!(a._isIn(t,sX,sY+sH))&&(a._isIn(t,sX+sW,sY))&&!(a._isIn(t,sX+sW,sY+sH)))core.snap._alignBottomToTop(t,s);else if(!(a._isIn(t,sX,sY))&&(a._isIn(t,sX,sY+sH))&&!(a._isIn(t,sX+sW,sY))&&(a._isIn(t,sX+sW,sY+sH)))core.snap._alignTopToBottom(t,s);else if(cX<=(tX+tW/2)&&cY<=(tY+tH/2)){if(centerIn)core.snap._alignTopToBottom(t,s);else core.snap._alignRightToLeft(t,s)}else if(cX<=(tX+tW/2)&&cY>=(tY+tH/2)){if(centerIn)core.snap._alignBottomToTop(t,s);else core.snap._alignRightToLeft(t,s)}else if(cX>=(tX+tW/2)&&cY<=(tY+tH/2)){if(centerIn)core.snap._alignTopToBottom(t,s);else core.snap._alignLeftToRight(t,s)}else if(cX>=(tX+tW/2)&&cY>=(tY+tH/2)){if(centerIn)core.snap._alignBottomToTop(t,s);else core.snap._alignLeftToRight(t,s)}};core.snap._isIn=function(s,x,y){if((x>=s.getX()&&x<=(s.getX()+s.getW()))&&(y>=s.getY()&&y<=(s.getY()+s.getH())))return true;else return false};core.snap._alignTopToBottom=function(elmFix,elmMove){var topFix=elmFix.getY();elmMove.setY(topFix-elmMove.getH())};core.snap._alignBottomToTop=function(elmFix,elmMove){var botFix=elmFix.getY()+elmFix.getH();elmMove.setY(botFix)};core.snap._alignLeftToRight=function(elmFix,elmMove){var leftFix=elmFix.getX()+elmFix.getW();elmMove.setX(leftFix)};core.snap._alignRightToLeft=function(elmFix,elmMove){var rightFix=elmFix.getX();elmMove.setX(rightFix-elmMove.getW())};
