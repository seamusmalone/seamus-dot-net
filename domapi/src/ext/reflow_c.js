// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.reflow=new Object();core.reflow._elms=[];core.getX=function(){return 0};core.getY=function(){return 0};core.getW=core.bodyWidth;core.getH=core.bodyHeight;core.reflow.initElm=function(o){var r;if(o==null)r=core.reflow;if(o!=null){if(!o.reflow)o.reflow=new Object();if(!o.reflow._elms)o.reflow._elms=[]}};core.reflow.on=function(){core.addEvent(window,"resize",this._windowResized,true);core.elmProto.regHook('setW',core.reflow._setW);core.elmProto.regHook('setH',core.reflow._setH);core.elmProto.regHook('setX',core.reflow._setX);core.elmProto.regHook('setY',core.reflow._setY);core.elmProto.regHook('setSize',core.reflow._setSize);core.elmProto.regHook('dragEnd',core.reflow.initValues);core.reflowStatus=true};core.reflow.off=function(){core.removeEvent(window,"resize",this._windowResized,true);core.elmProto.unRegHook('setX',core.reflow._setX);core.elmProto.unRegHook('setY',core.reflow._setY);core.elmProto.unRegHook('setW',core.reflow._setW);core.elmProto.unRegHook('setH',core.reflow._setH);core.elmProto.unRegHook('setSize',core.reflow._setSize);core.elmProto.unRegHook('dragEnd',core.reflow.initValues);core.reflowStatus=false};core.createElm2=function(p,x,y,w,h,bg,c,t){var o=document.createElement(core.rVal(t,"DIV"));o.id="domAPI_Elm_"+core.bags.elms.length;if(p)p.appendChild(o);else document.body.appendChild(o);var e=core.Elm2(o);e.reflowOn(p,{minX:0,minY:0,minW:0,minH:0,maxX:0,maxY:0,maxW:0,maxH:0});if(!p)p=core;if(typeof x=='string'){if(x>100)x=100;e.reflowSetBoundary({minX:null,maxX:null});x=((p.getW()/100)*x)}if(typeof y=='string'){if(y>100)y=100;e.reflowSetBoundary({minY:null,maxY:null});y=((p.getH()/100)*y)}if(typeof w=='string'){if(w>100)w=100;e.reflowSetBoundary({minW:null,maxW:null});w=((p.getW()/100)*w)}if(typeof h=='string'){if(h>100)h=100;e.reflowSetBoundary({minH:null,maxH:null});h=((p.getH()/100)*h)}if(x==null&&y==null)e.setPosition("relative");else{e.moveTo(core.rInt(x),core.rInt(y));e.setOverflow("hidden")}if(!core.isNil(c))e.setColor(c);if(!core.isNil(bg))e.setBgColor(bg);if(!core.isNil(w))e.setW(w);if(!core.isNil(h))e.setH(h);return e};core.elmProto.reflowOn=function(p,boundary){this.reflowStatus=true;if(!p)p=core;if(!p.reflow)p.reflow=new Object();if(!p.reflow._elms)p.reflow._elms=[];p.reflowChildren=true;if(!boundary)boundary=new Object();core.reflow.initElm(p);if(!p){p=core}p.reflow.X=p.getX();p.reflow.Y=p.getY();if(!this.reflow){this.reflow=new Object()}var r=this.reflow;r.X=this.getX();r.Y=this.getY();r.W=this.getW();r.H=this.getH();r.originalBodyWidth=p.getW();r.originalBodyHeight=p.getH();r.parent=p;r.boundary=boundary;p.reflow._elms[p.reflow._elms.length]=this};core.elmProto.reflowSetBoundary=function(boundary){if(!this.reflow)return;if(!boundary)boundary=new Object();var r=this.reflow;for(var a in boundary){r.boundary[a]=boundary[a]}};core.reflow.initValues=function(e){if((!e.reflowStatus)||(e.reflowStatus=='go'))return;if(!e.domAPIObjType)return;var r=e.reflow;r.originalBodyWidth=r.parent.getW();r.originalBodyHeight=r.parent.getH();r.X=e.getX();r.Y=e.getY();r.W=e.getW();r.H=e.getH();if(r._elms)for(var a=0;a<r._elms.length;a++)core.reflow.initValues(r._elms[a])};core.reflow._windowResized=function(){var elms=core.reflow._elms;core.reflow._resizeW(elms,core.bodyWidth());core.reflow._resizeH(elms,core.bodyHeight());core.reflow._resizeX(elms,core.bodyWidth());core.reflow._resizeY(elms,core.bodyHeight())};core.reflow._resizeX=function(elms,width){var x,b,e,er;for(var a=0;a<elms.length;a++){e=elms[a];er=e.reflow;e.reflowStatus='go';b=er.boundary;if(er.parent!=e.parentNode){x=er.parent.getX()+((er.X-er.parent.reflow.X)*(width/er.originalBodyWidth))}else{x=er.X*(width/er.originalBodyWidth)}if((b.minX!=null)&&(x<=(er.X-b.minX)))x=(er.X-b.minX);else if((b.maxX!=null)&&(x>=(er.X+b.maxX)))x=(er.X+b.maxX);e.setX(x);e.reflowStatus=true}};core.reflow._resizeY=function(elms,height){var y,b,e,er;for(var a=0;a<elms.length;a++){e=elms[a];er=e.reflow;e.reflowStatus='go';b=er.boundary;if(er.parent!=e.parentNode){y=er.parent.getY()+((er.Y-er.parent.reflow.Y)*(height/er.originalBodyHeight))}else{y=er.Y*(height/er.originalBodyHeight)}if((b.minY!=null)&&(y<=(er.Y-b.minY)))y=(er.Y-b.minY);else if((b.maxY!=null)&&(y>=(er.Y+b.maxY)))y=(er.Y+b.maxY);e.setY(y);e.reflowStatus=true}};core.reflow._resizeW=function(elms,width){var w,b,e,er;for(var a=0;a<elms.length;a++){e=elms[a];er=elms[a].reflow;e.reflowStatus='go';b=er.boundary;w=er.W*(width/er.originalBodyWidth);if(w<1)w=1;if((b.minW!=null)&&(w<=(er.W-b.minW)))w=(er.W-b.minW);else if((b.maxW!=null)&&(w>=(er.W+b.maxW)))w=(er.W+b.maxW);elms[a].setW(w);e.reflowStatus=true}};core.reflow._resizeH=function(elms,height){var h,b,e,er;for(var a=0;a<elms.length;a++){e=elms[a];er=elms[a].reflow;e.reflowStatus='go';b=er.boundary;h=er.H*(height/er.originalBodyHeight);if(h<1)h=1;if((b.minH!=null)&&(h<=(er.H-b.minH)))h=(er.H-b.minH);else if((b.maxH!=null)&&(h>=(er.H+b.maxH)))h=(er.H+b.maxH);elms[a].setH(h);e.reflowStatus=true}};core.reflow._setX=function(e,args){if((e.reflowStatus)&&(!e.selectionStatus))core.reflow.initValues(e);if(e.reflowChildren){core.reflow._resizeX(e.reflow._elms,e.getW())}};core.reflow._setY=function(e,args){if((e.reflowStatus)&&(!e.selectionStatus))core.reflow.initValues(e);if(e.reflowChildren){core.reflow._resizeY(e.reflow._elms,e.getH())}};core.reflow._setW=function(e,args){if((e.reflowStatus)&&(!e.selectionStatus))core.reflow.initValues(e);if(e.reflowChildren){core.reflow._resizeW(e.reflow._elms,e.getW());core.reflow._resizeX(e.reflow._elms,e.getW())}};core.reflow._setH=function(e,args){if((e.reflowStatus)&&(!e.selectionStatus))core.reflow.initValues(e);if(e.reflowChildren){core.reflow._resizeH(e.reflow._elms,e.getH());core.reflow._resizeY(e.reflow._elms,e.getH())}};core.reflow._setSize=function(e,args){core.reflow._setW(e,args);core.reflow._setH(e,args)};core.elmProto.reflowStatus=false;core.elmProto.reflowChildren=false;core.reflow.on();
