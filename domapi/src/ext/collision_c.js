// Copyright 2001-2003, Nebiru Software
// www.domapi.com
debugCollision=false;core.collision=new Object();core.elmProto.hasHit=function(t){return core.collision.hasHit(this,t)};core.collision.hasHit=function(s,t){var allCollisions=new Array();var c;if(typeof t=='string'){if(core.gridSearch&&core.gridSearch.gridOn)c=core.collision._checkCollisionInQuads(s,t);else c=core.collision._checkCollision(s,t);if(c)allCollisions.push(c)}else if((typeof t=='object')&&(!t.domAPIObjType)){for(var i=0;i<t.length;i++){if(core.gridSearch&&core.gridSearch.gridOn)c=core.collision._checkCollisionInQuads(s,t[i]);else c=core.collision._checkCollision(s,t[i]);if(c)allCollisions.push(c)}}else if(t.domAPIObjType)if(core.collision._isColl(s,t))allCollisions.push([t]);return allCollisions};core.collision._isColl=function(s,t){var sX,sY,sW,sH,tX,tY,tW,tH;sX1=s.getX();sY1=s.getY();sX2=sX1+s.getW();sY2=sY1+s.getH();tX1=t.getX();tY1=t.getY();tX2=tX1+t.getW();tY2=tY1+t.getH();if((s!=t)&&(tY1<=sY1&&tY2>=sY1||tY1<=sY2&&tY2>=sY2||tY1>=sY1&&tY2<=sY2)&&(tX1<=sX1&&tX2>=sX1||tX1<=sX2&&tX2>=sX2||tX1>=sX1&&tX2<=sX2)){if(debugCollision)alert('collision');return true}return false};core.collision._checkCollision=function(s,g){var group=core.groups.getGroup(g);var collisions=new Array();if(group){for(var i=0;i<group.length;i++)if(core.collision._isColl(s,group[i]))collisions.push(group[i])}else alert("!!-- Group '"+g+"' does not exist");return collisions};core.collision._checkCollisionInQuads=function(s,g){var group=core.groups.getGroup(g);var quads=core.gridSearch.elmInQuad(s);var collisions=new Array();if(group&&quads)for(var j=0;j<group.length;j++)for(var k=0;k<quads.length;k++)for(var l=0;l<quads[k].elms.length;l++){var t=quads[k].elms[l];if(group.indexOf(t)>=0)if(core.collision._isColl(s,t))collisions.push(t)}if(core.gridSearch.ignoredList.indexOf(s)>=0&&group)for(var i=0;i<group.length;i++)if(core.collision._isColl(s,group[i]))collisions.push(group[i]);if(core.gridSearch.searchAll)for(var i=0;i<core.gridSearch.ignoredList.length;i++)if(core.collision._isColl(s,core.gridSearch.ignoredList[i]))collisions.push(core.gridSearch.ignoredList[i]);return collisions};
