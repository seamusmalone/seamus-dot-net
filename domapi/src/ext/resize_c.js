// Copyright 2001-2003, Nebiru Software
// www.domapi.com
core.loadUnit("selection");core.loadUnit("drag");core.loadUnit("groups");core.resize=new Object();core.resize.on=function(group){if(group){core.groups.callFunction(group,"resizeOn()")}else{this.resizeStatus=true}core.elmProto.regHook('setX',core.resize._resetControls);core.elmProto.regHook('setX',core.resize._resetControls);core.elmProto.regHook('setY',core.resize._resetControls);core.elmProto.regHook('setY',core.resize._resetControls);core.elmProto.regHook('setW',core.resize._resetControls);core.elmProto.regHook('setH',core.resize._resetControls);core.elmProto.regHook('moveTo',core.resize._resetControls);core.elmProto.regHook('dragEnd',core.resize._resetControls)};core.resize.off=function(group){if(group){core.groups.callFunction(group,"resizeOff()")}else{core.resize._deselect(this);this.resizeStatus=false}core.elmProto.unRegHook('setX',core.resize._resetControls);core.elmProto.unRegHook('setX',core.resize._resetControls);core.elmProto.unRegHook('setY',core.resize._resetControls);core.elmProto.unRegHook('setY',core.resize._resetControls);core.elmProto.unRegHook('setW',core.resize._resetControls);core.elmProto.unRegHook('setH',core.resize._resetControls);core.elmProto.unRegHook('moveTo',core.resize._resetControls);core.elmProto.unRegHook('dragEnd',core.resize._resetControls)};core.resize._select=function(e){e.resize=new Object();var er=e.resize;var csc=core.selection.controls;er.originalX=e.getX();er.originalY=e.getY();er.originalW=e.getW();er.originalH=e.getH();er.minX=0;er.minY=0;er.minH=(csc.offset<csc.size)?(csc.size*2)-(csc.offset*2):1;er.minW=(csc.offset<csc.size)?(csc.size*2)-(csc.offset*2):1;er.maxX=(e.parentNode==document.body)?core.bodyWidth():e.parentNode.getW();er.maxY=(e.parentNode==document.body)?core.bodyHeight():e.parentNode.getH();var c=e.selection.controls;l=core.selection.lookupControls;for(var i=0;i<8;i++){if(c[i])c[i].turnOnDrag(null,core.drag.dtCustom,0,null,core.resize["_moveControl"+l[i].charAt(0).toUpperCase()+l[i].substr(1)],core.resize._resetControls)}e.resizeStatus="go"};core.resize._deselect=function(e){if(!e.resizeStatus)return;var c=e.selection.controls;l=core.selection.lookupControls;for(var i=0;i<8;i++){if(c[i])c[i].turnOffDrag()}e.resizeStatus=true;e.resize=null};core.resize._resetControls=function(e){var parent=(!e)?this.elm.parent:e;if((!parent.resizeStatus)||(!parent.resize)||(parent.resizeStatus=='go'))return;var pr=parent.resize;pr.originalX=parent.getX();pr.originalY=parent.getY();pr.originalW=parent.getW();pr.originalH=parent.getH();if(parent.reflowStatus)core.reflow.initValues(parent);parent.resizeStatus=true};core.resize._moveControlLeftTop=function(x,y,dX,dY){var parent=this.elm.parent;var pr=parent.resize;parent.resizeStatus="go";if(pr.originalX+dX<=pr.minX){dX=pr.minX-pr.originalX}else if(pr.originalX+dX>=pr.originalX+pr.originalW-pr.minW){dX=pr.originalW-pr.minW}if(pr.originalY+dY<=pr.minY){dY=pr.minY-pr.originalY}else if(pr.originalY+dY>=pr.originalY+pr.originalH-pr.minH){dY=pr.originalH-pr.minH}var x=pr.originalX+dX;var w=pr.originalW-dX;var y=pr.originalY+dY;var h=pr.originalH-dY;parent.setX(x);parent.setW(w);parent.setY(y);parent.setH(h);parent.resizeStatus=true};core.resize._moveControlLeftMiddle=function(x,y,dX,dY){var parent=this.elm.parent;var pr=parent.resize;parent.resizeStatus="go";if(pr.originalX+dX<=pr.minX){dX=pr.minX-pr.originalX}else if(pr.originalX+dX>=pr.originalX+pr.originalW-pr.minW){dX=pr.originalW-pr.minW}var x=pr.originalX+dX;var w=pr.originalW-dX;parent.setX(x);parent.setW(w);parent.resizeStatus=true};core.resize._moveControlLeftBottom=function(x,y,dX,dY){var parent=this.elm.parent;var pr=parent.resize;parent.resizeStatus="go";if(pr.originalX+dX<=pr.minX){dX=pr.minX-pr.originalX}else if(pr.originalX+dX>=pr.originalX+pr.originalW-pr.minW){dX=pr.originalW-pr.minW}if(pr.originalH+dY<=pr.minH){dY=0-pr.originalH+pr.minH}else if(pr.originalY+dY+pr.originalH>=pr.maxY){dY=pr.maxY-(pr.originalY+pr.originalH)}var h=pr.originalH+dY;var x=pr.originalX+dX;var w=pr.originalW-dX;parent.setX(x);parent.setW(w);parent.setH(h);parent.resizeStatus=true};core.resize._moveControlCentreTop=function(x,y,dX,dY){var parent=this.elm.parent;var pr=parent.resize;parent.resizeStatus="go";if(pr.originalY+dY<=pr.minY){dY=pr.minY-pr.originalY}else if(pr.originalY+dY>=pr.originalY+pr.originalH-pr.minH){dY=pr.originalH-pr.minH}var y=pr.originalY+dY;var h=pr.originalH-dY;parent.setY(y);parent.setH(h);parent.resizeStatus=true};core.resize._moveControlCentreBottom=function(x,y,dX,dY){var parent=this.elm.parent;var pr=parent.resize;parent.resizeStatus="go";if(pr.originalH+dY<=pr.minH){dY=0-pr.originalH+pr.minH}else if(pr.originalY+dY+pr.originalH>=pr.maxY){dY=pr.maxY-(pr.originalY+pr.originalH)}var h=pr.originalH+dY;parent.setH(h);parent.resizeStatus=true};core.resize._moveControlRightTop=function(x,y,dX,dY){var parent=this.elm.parent;var pr=parent.resize;parent.resizeStatus="go";if(pr.originalX+pr.originalW+dX>=pr.maxX){dX=pr.maxX-pr.originalX-pr.originalW}else if(dX<(0-pr.originalW+pr.minW)){dX=0-pr.originalW+pr.minH}if(pr.originalY+dY<=pr.minY){dY=pr.minY-pr.originalY}else if(pr.originalY+dY>=pr.originalY+pr.originalH-pr.minH){dY=pr.originalH-pr.minH}var y=pr.originalY+dY;var w=pr.originalW+dX;var h=pr.originalH-dY;parent.setW(w);parent.setY(y);parent.setH(h);parent.resizeStatus=true};core.resize._moveControlRightMiddle=function(x,y,dX,dY){var parent=this.elm.parent;var pr=parent.resize;parent.resizeStatus="go";if(pr.originalX+pr.originalW+dX>=pr.maxX){dX=pr.maxX-pr.originalX-pr.originalW}else if(dX<(0-pr.originalW+pr.minW)){dX=0-pr.originalW+pr.minW}var w=pr.originalW+dX;parent.setW(w);parent.resizeStatus=true};core.resize._moveControlRightBottom=function(x,y,dX,dY){var parent=this.elm.parent;var pr=parent.resize;parent.resizeStatus="go";if(pr.originalX+pr.originalW+dX>=pr.maxX){dX=pr.maxX-pr.originalX-pr.originalW}else if(dX<(0-pr.originalW+pr.minW)){dX=0-pr.originalW+pr.minW}if(pr.originalH+dY<=pr.minH){dY=0-pr.originalH+pr.minH}else if(pr.originalY+dY+pr.originalH>=pr.maxY){dY=pr.maxY-(pr.originalY+pr.originalH)}var h=pr.originalH+dY;var w=pr.originalW+dX;parent.setW(w);parent.setH(h);parent.resizeStatus=true};core.elmProto.resizeOn=core.resize.on;core.elmProto.resizeOff=core.resize.off;core.elmProto.resizeStatus=false;
